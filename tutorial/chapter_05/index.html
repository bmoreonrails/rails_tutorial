<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
      <base target="_blank"/>
    
    <title>B'more on Rails Workshop for Women</title>
    <link href="/rails_tutorial/css/syntax/monokai.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/css/base.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/assets/vendor/css/featherlight.min.css" type="text/css" rel="stylesheet">
    <script src="/rails_tutorial/js/jquery.min.js"></script>
    <script src="/rails_tutorial/assets/vendor/js/featherlight.min.js"></script>
    <script src="/rails_tutorial/js/tutorial_nav.js"></script>
    <script src="/rails_tutorial/js/progress.js"></script>
  </head>

<body>
  <div class="container" data-chapter="5">
    <nav>
      
<div class="tutorial_nav">
  <div class="progress"><div class="progress_bar"></div></div>
  <ul id="menu-list">
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_01/" target="_self">
        1 Getting Started from Scratch
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_02/" target="_self">
        2 Creating the First Table in Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_03/" target="_self">
        3 Viewing Data in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_04/" target="_self">
        4 Showing Detailed Information in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_05/" target="_self">
        5 Creating Books Through the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_06/" target="_self">
        6 Updating Books
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_07/" target="_self">
        7 Styling Your Bookstore
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_08/" target="_self">
        8 Deleting a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_09/" target="_self">
        9 Reviewing a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_10/" target="_self">
        10 Showing Reviews
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_11/" target="_self">
        11 Adding Reviews from the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_12/" target="_self">
        12 Adding Users to Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_13/" target="_self">
        13 Logging In and Logging Out
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_14/" target="_self">
        14 Logged In vs Logged Out Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_15/" target="_self">
        15 Associating Reviews with Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_16/" target="_self">
        16 The End!
       </a>
     </li>
    
   </ul>

  <div class="menu">
    <div class="hamburger-icon" data-toggle="#menu-list"> &#9776</div>
    <div class="menu-title" data-toggle="#menu-list">Chapter 5 -- Creating Books Through the Browser</div>
    <div class="menu-title"><a href="/rails_tutorial/" target="_self">Home</a></div>
  </div>
</div>

    </nav>
    <div class="content">
      <div class="sectionheader">
<p>Creating Books Through the Browser</p>
</div>

<div class="aside">
<p>So far you’ve created books on the <code class="highlighter-rouge">rails console</code>. It works, but it’s not the best experience. In most web applications, you enter data through…the web.</p>

<p>Your bookstore <em>is</em> a web application, so let’s treat it like one. Let’s set up your application so you can create books from your browser.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open Terminal and go to the <code class="highlighter-rouge">bookstore</code> directory.</p>
  </li>
  <li>
    <p>Now, run <code class="highlighter-rouge">rake routes</code>.</p>

    <p>We’ve worked through a couple of the books routes. First, we used the <code class="highlighter-rouge">index</code> action to list all your application’s books. Then, we used the <code class="highlighter-rouge">show</code> action to show details for a given book.</p>

    <p>Now, we’ll use the <code class="highlighter-rouge">new</code> action to create a new book.</p>
  </li>
  <li>
    <p>The path for the <code class="highlighter-rouge">new</code> action is <code class="highlighter-rouge">/books/new</code>.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>      books#new
</code></pre>
    </div>

    <p>Let’s try going to that path.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span><span class="nb">pwd</span>
  /Users/awesomesauce/Projects/bookstore

  <span class="nv">$ </span>rake routes
     Prefix Verb   URI Pattern               Controller#Action
      books GET    /books<span class="o">(</span>.:format<span class="o">)</span>          books#index
            POST   /books<span class="o">(</span>.:format<span class="o">)</span>          books#create
   new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>      books#new
  edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span> books#edit
       book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#show
            PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#destroy</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In Terminal, start your application’s web server by running <code class="highlighter-rouge">rails server</code>.</p>
  </li>
  <li>
    <p>Now, try going to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>
  </li>
  <li>
    <p>You got an error, but doesn’t it look familiar?</p>

    <p>Why you think you got an Unknown action error?</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>rails server
  <span class="o">=</span>&gt; Booting Puma
  <span class="o">=</span>&gt; Rails 5.0.0.1 application starting <span class="k">in </span>development on http://localhost:3000
  <span class="o">=</span>&gt; Run <span class="sb">`</span>rails server -h<span class="sb">`</span> <span class="k">for </span>more startup options</code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/unknown_action_new.png" alt="Browser showing Unknown action error: &quot;The action 'new' could not be found for BooksController&quot;" class="screenshot" /></p>

<div class="aside">
<p>The error message gives you a hint as to why you’re getting an Unknown action error.</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>The action 'new' could not be found for BooksController
</code></pre>
</div>

<p>When you make a request to <code class="highlighter-rouge">/books/new</code>, your request gets routed to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">new</code> action. What does your <code class="highlighter-rouge">BooksController</code> look like? Does it have a <code class="highlighter-rouge">new</code> action?</p>

<p>The <code class="highlighter-rouge">BooksController</code> doesn’t have a <code class="highlighter-rouge">new</code> action because we haven’t defined it yet.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In your text editor, open the <code class="highlighter-rouge">BooksController</code> (<code class="highlighter-rouge">app/controllers/boooks_controller.rb</code>).</p>
  </li>
  <li>
    <p>At the end of the <code class="highlighter-rouge">BooksController</code> add the <code class="highlighter-rouge">new</code> method.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/UnknownFormat_in_BooksController_new.png" alt="Browser showing ActionController::UnknownFormat error: &quot;BooksController#new is missing a template for this request format and variant.&quot;" class="screenshot" /></p>

<div class="aside">
<p>Another error, but it should also look familiar.</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>BooksController#new is missing a template for this request format and variant.
</code></pre>
</div>

<p>You’ve added the <code class="highlighter-rouge">new</code> method to the <code class="highlighter-rouge">BooksController</code>, but you haven’t created the <code class="highlighter-rouge">new</code> action’s template.</p>

<p>Let’s add it!</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Go back to terminal and stop your application’s web server by running <code class="highlighter-rouge">Ctrl-C</code>.</p>
  </li>
  <li>
    <p>Now, run <code class="highlighter-rouge">touch app/views/books/new.html.erb</code> to create the <code class="highlighter-rouge">new</code> action’s template.</p>
  </li>
  <li>
    <p>Restart your application’s web server and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>. What do you see?</p>

    <p>A blank page! 🎉</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>rails server
  ...
  ^CExiting

  <span class="nv">$ </span>touch app/views/books/new.html.erb

  <span class="nv">$ </span>rails server
  <span class="o">=</span>&gt; Booting Puma
  <span class="o">=</span>&gt; Rails 5.0.0.1 application starting <span class="k">in </span>development on http://localhost:3000
  <span class="o">=</span>&gt; Run <span class="sb">`</span>rails server -h<span class="sb">`</span> <span class="k">for </span>more startup options</code></pre></figure>

</div>

<div class="aside">
<h3 id="a-little-about-forms">A Little About Forms</h3>

<p>Data is usually added to web applications through forms.</p>

<p>You probably have never noticed them, but forms are everywhere on the internet. When you login to a site, you enter your credentials into a form. When you post a status on Facebook, you enter your status into a form. When you’re Googling for programming resources, you enter your search terms into a form.</p>

<p>After you add your data to a form, you submit it by clicking a submit button. For example, a login form might have a submit button that says “Login”.</p>

<p>We’re going to use forms to create new books in your application.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In your text editor, open <code class="highlighter-rouge">app/views/books/new.html.erb</code> and add the following code:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p><code class="highlighter-rouge">form_for</code> is a method provided by Rails. It provides a consistent interface to build forms inside Rails applications.</p>

    <p>Here, we’re passing <code class="highlighter-rouge">@book</code> to <code class="highlighter-rouge">form_for</code> because we want to create a form for a book.</p>

    <p><code class="highlighter-rouge">form_for</code> takes a block as its last argument. We haven’t done anything interesting inside the block, but that’ll change soon 😉</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/argument_error_books_new.png" alt="Browser showing Argument Error in Books#new: &quot;First argument in form cannot contain nil or be empty&quot;" class="screenshot" /></p>

<div class="aside">
<p>Hmm…an error.</p>

<p>You’re seeing an <code class="highlighter-rouge">ArgumentError</code> in <code class="highlighter-rouge">Books#new</code>. There’s a lot going on in the error, but the message has a helpful hint.</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>First argument in form cannot contain nil or be empty
</code></pre>
</div>

<p>Remember the code we used to start the form?</p>

<div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">@book</code> is the first argument in the form, so the error is telling us <code class="highlighter-rouge">@book</code> must be nil or empty.</p>

<p>How could <code class="highlighter-rouge">@book</code> be nil?</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor and take a look at the <code class="highlighter-rouge">new</code> method.</p>

    <p>Is <code class="highlighter-rouge">@book</code> defined inside in the new method?</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code>def new
end
</code></pre>
    </div>

    <p>It’s nowhere to be found! That explains that error 😅</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Let’s fix that error.</p>

<ol>
  <li>
    <p>Inside the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">new</code> method, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
</code></pre>
    </div>

    <p><code class="highlighter-rouge">@book</code> is set to be a new book because we want to create a form for new books.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>No errors! But we still have a blank page. Let’s start building out that form.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In your text editor, open <code class="highlighter-rouge">app/views/books.new.html.erb</code>.</p>
  </li>
  <li>
    <p>Inside the <code class="highlighter-rouge">form_for</code> block, add the following:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= f.label :title %&gt;
    &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="o">%&gt;</span>
  <span class="o">&lt;</span><span class="sr">/li&gt;

  &lt;li&gt;
    &lt;%= f.label :author %&gt;
    &lt;%= f.text_field :author %&gt;
  &lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/ul&gt;
</span></code></pre>
    </div>

    <p>We’re putting your form elements inside an unordered list. The form will have two fields, one for title and one for author.</p>

    <p><code class="highlighter-rouge">f.label</code> defines labels for each field.</p>

    <p><code class="highlighter-rouge">f.text_field</code> creates a text input field for each field.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>Can you match the code you added to the different elements on the page?</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Your new book form has fields for title and author.</p>

    <p>Try adding a field for the price. Remember, we named the field <code class="highlighter-rouge">price_cents</code>.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>What did you come up with? If you followed the pattern used for the other two fields, you probably came up with something like this:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;li&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</code></pre>
    </div>

    <p>That works well, but <code class="highlighter-rouge">price_cents</code> isn’t a text field. It’s a number.</p>

    <p>To make it a number field, simply change</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Your full solution should look like this:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;li&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</code></pre>
    </div>

    <p>Update your solution, save your changes, and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>Does the <code class="highlighter-rouge">price_cents</code> field differ from other fields on the page?</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>We have a couple more fields to add to the form. We need fields for quantity and description.</p>

<ol>
  <li>
    <p>Add <code class="highlighter-rouge">quantity</code> to your form as a <code class="highlighter-rouge">number_field</code>.</p>
  </li>
  <li>
    <p>Add <code class="highlighter-rouge">description</code> to your form as a <code class="highlighter-rouge">text_area</code>.</p>

    <p>(<code class="highlighter-rouge">text_area</code> differs from <code class="highlighter-rouge">text_field</code> by offering more space for text - which is useful for long descriptions.)</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>What does your solution look like? Your complete form should look like this:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Update your solution to match this solution and save your changes.</p>
  </li>
</ol>
</div>
</div>

<p><img src="/rails_tutorial/assets/images/form.png" alt="Browser showing &quot;/books/new&quot; with a form full of fields" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>Now you have a beautiful form full of fields. You can enter so much book data! 😍</p>

<p>But there’s no way for you to save that data in your application’s database 😞</p>

<p>Don’t worry! We can fix that!</p>

<ol>
  <li>
    <p>At the end of the <code class="highlighter-rouge">form_for</code> block`, add the following line:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>This will add a submission button to your form.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p><code class="highlighter-rouge">f.submit</code> generates a button labeled “Create Book”.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/form_with_button.png" alt="Browser showing &quot;/books/new&quot; with a form you can submit" class="screenshot" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now that you have a form with a shiny “Create Book” button, why don’t you try creating a book?</p>

    <p>Fill out the form and click “Create Book”.</p>
  </li>
  <li>
    <p>Error? ERROR?!</p>

    <p><img src="/rails_tutorial/assets/images/anger.gif" alt="Anger!" /></p>

    <p>You’re getting an <code class="highlighter-rouge">Unknown action</code> error that says “The action ‘create’ could not be found for BooksController”.</p>

    <p>Huh?</p>

    <p>We’ve been working with the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">new</code> action? How did we end up with an error for the <code class="highlighter-rouge">create</code> action?</p>
  </li>
</ol>
</div>
</div>

<p><img src="/rails_tutorial/assets/images/unknown_action_create.png" alt="Browser showing &quot;/books/new&quot; with a form you can submit" class="screenshot" /></p>

<div class="aside">
<p>Take a look at what happened in your application’s web server when you clicked “Create Book”.</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>Started POST <span class="s2">"/books"</span> <span class="k">for</span> ::1 at 2016-12-27 14:32:50 -0500

AbstractController::ActionNotFound <span class="o">(</span>The action <span class="s1">'create'</span> could not be found <span class="k">for </span>BooksController<span class="o">)</span>:
</code></pre>
</div>

<p>Before the error happened, the server received a POST request to the <code class="highlighter-rouge">/books</code> path. This request happened when you clicked the “Create Book” button.</p>

<p>Your form’s data was submitted as a POST request to the <code class="highlighter-rouge">/books</code> path.</p>

<p>Real interesting, right? Let’s take a look at your application routes again.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Go back to Terminal and stop your application’s web server by running <code class="highlighter-rouge">Ctrl-C</code>. Then, run <code class="highlighter-rouge">rake routes</code>.</p>
  </li>
  <li>
    <p>Take a look at the second row of the routing table.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>POST   /books<span class="o">(</span>.:format<span class="o">)</span>          books#create
</code></pre>
    </div>

    <p>Does that look familiar? 😉</p>

    <p>POST requests to <code class="highlighter-rouge">/books</code> get sent to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action!</p>

    <p>It looks like we were destined to reach the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action, but how did the form know to go there?</p>

    <p>By default, a <code class="highlighter-rouge">form_for</code> with a new record will be wired up to POST requests to its matching <code class="highlighter-rouge">create</code> action.</p>

    <p>In our case, we setup <code class="highlighter-rouge">form_for</code> with a new book. Therefore, the form was setup to POST to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action.</p>

    <p>Does this make sense to you? If it does, I’m impressed. I’m having a hard time understanding it all. 😅</p>
  </li>
  <li>
    <p>Don’t worry if you don’t understand everything that is going on. It will make more sense over time.</p>

    <p>The key take away here is the <code class="highlighter-rouge">new</code> book form gets <em>submitted</em> to the <code class="highlighter-rouge">BooksController</code> create action.</p>
  </li>
  <li>
    <p>Restart your application’s web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>rails server
  ...
  ^CExiting

  <span class="nv">$ </span>rake routes
     Prefix Verb   URI Pattern               Controller#Action
      books GET    /books<span class="o">(</span>.:format<span class="o">)</span>          books#index
            POST   /books<span class="o">(</span>.:format<span class="o">)</span>          books#create
   new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>      books#new
  edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span> books#edit
       book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#show
            PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#destroy

  <span class="nv">$ </span>rails server</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor.</p>
  </li>
  <li>
    <p>Add a <code class="highlighter-rouge">create</code> method to the end of the controller.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes and try adding a book again.</p>

    <p>Nothing happens! Hey, it’s better than an error…</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></figure>

</div>

<div class="aside">
<p>The <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action is going to be responsible for using your form data to create a new book.</p>

<p>Take a look at the request parameters that are sent when you submit the new book form.</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>Started POST <span class="s2">"/books"</span> <span class="k">for</span> ::1 at 2016-12-27 15:29:52 -0500
Processing by BooksController#create as HTML
  Parameters: <span class="o">{</span><span class="s2">"utf8"</span><span class="o">=</span>&gt;<span class="s2">"✓"</span>, <span class="s2">"authenticity_token"</span><span class="o">=</span>&gt;<span class="s2">"AOZpk66Fc20R/9xHVhxZLiSwsQj29isG2ohi9gS6TKXT0PUP3n9hYJQrPpY8iSx6uessf9Sgsd3Uv3rEuB/TvQ=="</span>, <span class="s2">"book"</span><span class="o">=</span>&gt;<span class="o">{</span><span class="s2">"title"</span><span class="o">=</span>&gt;<span class="s2">"The Cat in the Hat"</span>, <span class="s2">"author"</span><span class="o">=</span>&gt;<span class="s2">"Dr. Seuss"</span>, <span class="s2">"price_cents"</span><span class="o">=</span>&gt;<span class="s2">"500"</span>, <span class="s2">"quantity"</span><span class="o">=</span>&gt;<span class="s2">"1000"</span>, <span class="s2">"description"</span><span class="o">=</span>&gt;<span class="s2">"That crazy cat!"</span><span class="o">}</span>, <span class="s2">"commit"</span><span class="o">=</span>&gt;<span class="s2">"Create Book"</span><span class="o">}</span>
</code></pre>
</div>

<p>Inside the parameters hash, there’s a “book” key with its own hash.</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="s2">"book"</span><span class="o">=</span>&gt;<span class="o">{</span><span class="s2">"title"</span><span class="o">=</span>&gt;<span class="s2">"The Cat in the Hat"</span>, <span class="s2">"author"</span><span class="o">=</span>&gt;<span class="s2">"Dr. Seuss"</span>, <span class="s2">"price_cents"</span><span class="o">=</span>&gt;<span class="s2">"500"</span>, <span class="s2">"quantity"</span><span class="o">=</span>&gt;<span class="s2">"1000"</span>, <span class="s2">"description"</span><span class="o">=</span>&gt;<span class="s2">"That crazy cat!"</span><span class="o">}</span>
</code></pre>
</div>

<p>This is the server output for the book <em>I</em> was trying to add, but your server output should look similar.</p>

<p>(Unless you were trying add <em>The Cat in the Hat</em>. Then, it should look pretty much the same…)</p>

<p>To get the book data that’s POSTed to the server, we need to access the <code class="highlighter-rouge">book</code> key in the <code class="highlighter-rouge">params</code> hash.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Add the following code to your <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
</code></pre>
    </div>

    <p>We’re using <code class="highlighter-rouge">Book.create</code> to create a new book. The new book’s attributes are being set with values from the <code class="highlighter-rouge">params</code> hash <code class="highlighter-rouge">book</code> key.</p>
  </li>
  <li>
    <p>Save you changes and try adding a book again.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Nothing happened, right?</p>

<p>Not exactly…</p>

<ol>
  <li>
    <p>Go to Terminal and stop your application’s web server.</p>
  </li>
  <li>
    <p>Now, run <code class="highlighter-rouge">rails console</code> and get the last book in your database.</p>

    <p>Does it look familiar?</p>

    <p>It’s the book you created!</p>

    <p>Although it looked like nothing happened when you clicked submit, the request made it to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action and <code class="highlighter-rouge">Book.create</code> was run.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">create</code> action is almost done. Now, we just need make the experience a little better.</p>

    <p>Exit <code class="highlighter-rouge">rails console</code> and restart your application’s web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="err">$</span> <span class="n">rails</span> <span class="n">server</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">^</span><span class="no">CExiting</span>

  <span class="err">$</span> <span class="n">rails</span> <span class="n">console</span>
  <span class="no">Loading</span> <span class="n">development</span> <span class="n">environment</span> <span class="p">(</span><span class="no">Rails</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
  <span class="o">&gt;&gt;</span> <span class="no">Book</span><span class="p">.</span><span class="nf">last</span>
    <span class="no">Book</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="s2">"books"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"books"</span> <span class="no">ORDER</span> <span class="no">BY</span> <span class="s2">"books"</span><span class="o">.</span><span class="s2">"id"</span> <span class="no">DESC</span> <span class="no">LIMIT</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"LIMIT"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
  <span class="o">=&gt;</span> <span class="c1">#&lt;Book id: 8, title: "The Cat in the Hat", author: "Dr. Seuss", price_cents: 500, created_at: "2016-12-27 20:46:15", updated_at: "2016-12-27 20:46:15", quantity: 1000, description: "That crazy cat!"&gt;</span>

  <span class="o">&gt;&gt;</span> <span class="nb">exit</span>

  <span class="err">$</span> <span class="n">rails</span> <span class="n">server</span></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In your text editor, open the <code class="highlighter-rouge">BooksController</code>.</p>
  </li>
  <li>
    <p>At the end of the <code class="highlighter-rouge">create</code> method, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">redirect_to</span> <span class="n">books_path</span>
</code></pre>
    </div>

    <p>With this change, you’ll be redirected to the <code class="highlighter-rouge">books_path</code> after a new book is created.</p>

    <p><code class="highlighter-rouge">books_path</code> is a Rails helper method. It evaluates to <code class="highlighter-rouge">/books</code> or your book index page.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>Add a new book and you will be redirected to the books index. The new book will show up at the end of the index.</p>

    <p><em>Magic</em></p>

    <p><img src="/rails_tutorial/assets/images/shia-magic.gif" alt="Magic" /></p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<h3 id="cleanup">Cleanup</h3>

<p>Ah, it feels like we’ve come so far from those days of creating books on the console…</p>

<p>What? It hasn’t been that long?</p>

<p>Anyways…</p>

<p>Things are coming together nicely. Let’s take a look at cleaning some stuff up. First, we’ll start with the <code class="highlighter-rouge">BooksController</code>.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor and take a look at the <code class="highlighter-rouge">create</code> method.</p>
  </li>
  <li>
    <p>In the first line of the <code class="highlighter-rouge">create</code> method, you’re calling <code class="highlighter-rouge">Book.create</code> and setting attributes one by one from the params hash.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
</code></pre>
    </div>

    <p>Do you notice a pattern in the attributes that are being set?</p>

    <p>Every attribute that you’re setting is in <code class="highlighter-rouge">params[:book]</code>.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">]</span>
<span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">]</span>
<span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">]</span>
<span class="p">.</span><span class="nf">.</span><span class="o">.</span>
</code></pre>
    </div>

    <p>Since every attribute you’re setting is in <code class="highlighter-rouge">params[:book]</code>, we can simplify that line.</p>
  </li>
  <li>
    <p>Change <code class="highlighter-rouge">Book.create</code> from</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">])</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>, and try creating a book.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">])</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/ForbiddenAttribute_Error.png" alt="Browser showing ActiveModel::ForbiddenAttributesError in BooksController#create" class="screenshot" /></p>

<div class="aside">
<p>So…that didn’t work.</p>

<p>The change we made is valid, but we’re running into a Rails security feature.</p>

<p>Rails won’t let you set several attributes at once with data from a request. In this case, the data came from a request you generated. However, it’s not hard to imagine a malicious user sending harmful data.</p>

<p>Before you can set several attributes at once from request data, you have to explicitly state which attributes can be set. That’s why you’re seeing an <code class="highlighter-rouge">ActiveModel::ForbiddenAttributesError</code> - you haven’t permitted any attributes.</p>

<p>This security feature is called <a href="http://guides.rubyonrails.org/action_controller_overview.html#strong-parameters">strong parameters</a>.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Reopen your <code class="highlighter-rouge">BooksController</code>.</p>
  </li>
  <li>
    <p>To use strong parameters, change <code class="highlighter-rouge">Book.create</code> from</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">])</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">)</span>
</code></pre>
    </div>

    <p>When we want to create a book from the <code class="highlighter-rouge">params</code> hash, the <code class="highlighter-rouge">params</code> hash must have a <code class="highlighter-rouge">book</code> hash. From the <code class="highlighter-rouge">book</code> hash, we’ll get any of the permitted attributes and assign them to the new book.</p>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>, and try creating a book again.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>To create books in the browser, you’ve been going directly to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>. That works, but it isn’t very convenient.</p>

<p>Let’s add a link to the book index that will take us to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/view/books/index.html.erb</code> in your text editor.</p>
  </li>
  <li>
    <p>After the unordered list, add the following line:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">"Add a book"</span><span class="p">,</span> <span class="n">new_book_path</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>We’re using the <code class="highlighter-rouge">link_to</code> helper to create a link. The link’s text will be “Add a book”, and it will link to the new_book_path (<code class="highlighter-rouge">/books/new</code>).</p>
  </li>
  <li>
    <p>Save your changes and go to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>You should see the new link. Clicking it should take you to the new book form.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>  <span class="nt">&lt;h1&gt;</span>Welcome to My Super Rad Bookstore!<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@books</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">book</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="n">book</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">book_path</span><span class="p">(</span><span class="n">book</span><span class="p">))</span> <span class="cp">%&gt;</span> by <span class="cp">&lt;%=</span> <span class="n">book</span><span class="p">.</span><span class="nf">author</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">"Add a book"</span><span class="p">,</span> <span class="n">new_book_path</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/add_book_button.png" alt="Browser showing book index with link to &quot;Add a book&quot;" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>Now you can add all the books you heart desires from the comfort of your browser.</p>

<ol>
  <li>
    <p>When you’re done adding books and basking in the glory, stop your application’s web server and give yourself a high five.</p>

    <p><img src="/rails_tutorial/assets/images/liz-high-five.gif" alt="Liz Lemon with the self high five" /></p>
  </li>
</ol>
</div>
</div>

      <div class="tutorial-button-group">
  
    
      <a href="/rails_tutorial/tutorial/chapter_04/" target="_self">
        <div class="back-button">
          Chapter 4
        </div>
      </a>
    
    
      <a href="/rails_tutorial/tutorial/chapter_06/" target="_self">
        <div class="next-button">
          Chapter 6
        </div>
      </a>
    
  
</div>

    </div>
  </div>
<footer>
  <div class="container">
    <a href="http://bmoreonrails.org/">
      <img src="/rails_tutorial/assets/icons/bmore.png">
    </a>

    <a rel="license" href="/rails_tutorial/license" target="_self">
      <img class="icon"
           alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License"
           src="/rails_tutorial/assets/icons/cc-by-nc-sa.svg"
      />
    </a>

    <a href="https://github.com/bmoreonrails/rails_tutorial">
      <img class="icon"
           alt="Rails Tutorial on GitHub"
           src="/rails_tutorial/assets/icons/github.png"
      />
    </a>

    <a href="https://twitter.com/BmorRailsSchool">
      <img class="icon"
           alt="B'more on Rails School on Twitter"
           src="/rails_tutorial/assets/icons/twitter.png"
      />
    </a>
  </div>
</footer>
</body>
</html>


<script>

$('img.screenshot').featherlight({
    targetAttr: 'src'
});

</script>
