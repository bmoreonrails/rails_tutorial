<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
      <base target="_blank"/>
    
    <title>B'more on Rails Workshop for Women</title>
    <link href="/rails_tutorial/css/syntax/monokai.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/css/base.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/assets/vendor/css/featherlight.min.css" type="text/css" rel="stylesheet">
    <script src="/rails_tutorial/js/jquery.min.js"></script>
    <script src="/rails_tutorial/assets/vendor/js/featherlight.min.js"></script>
    <script src="/rails_tutorial/js/tutorial_nav.js"></script>
    <script src="/rails_tutorial/js/progress.js"></script>
  </head>

<body>
  <div class="container" data-chapter="11">
    <nav>
      
<div class="tutorial_nav">
  <div class="progress"><div class="progress_bar"></div></div>
  <ul id="menu-list">
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_01/" target="_self">
        1 Getting Started from Scratch
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_02/" target="_self">
        2 Creating the First Table in Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_03/" target="_self">
        3 Viewing Data in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_04/" target="_self">
        4 Showing Detailed Information in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_05/" target="_self">
        5 Creating Books Through the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_06/" target="_self">
        6 Updating Books
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_07/" target="_self">
        7 Styling Your Bookstore
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_08/" target="_self">
        8 Deleting a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_09/" target="_self">
        9 Reviewing a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_10/" target="_self">
        10 Showing Reviews
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_11/" target="_self">
        11 Adding Reviews from the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_12/" target="_self">
        12 Adding Users to Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_13/" target="_self">
        13 Logging In and Logging Out
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_14/" target="_self">
        14 Logged In vs Logged Out Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_15/" target="_self">
        15 Associating Reviews with Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_16/" target="_self">
        16 The End!
       </a>
     </li>
    
   </ul>

  <div class="menu">
    <div class="hamburger-icon" data-toggle="#menu-list"> &#9776</div>
    <div class="menu-title" data-toggle="#menu-list">Chapter 11 -- Adding Reviews from the Browser</div>
    <div class="menu-title"><a href="/rails_tutorial/" target="_self">Home</a></div>
  </div>
</div>

    </nav>
    <div class="content">
      <div class="sectionheader">
<p>Adding Reviews from the Browser</p>
</div>

<div class="aside">
<p>Now you can see your beautiful reviews, but wouldn‚Äôt it be nice if you could also <em>add</em> reviews??</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Let‚Äôs start by taking a look at your application‚Äôs routes file. In your text editor, open <code class="highlighter-rouge">config/routes.rb</code>.</p>

    <p>So far, you‚Äôve specified one resource in your routes file - books.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">resources</span> <span class="ss">:books</span>
</code></pre>
    </div>

    <p>It‚Äôs been a while since we‚Äôve been inside the routes file, but your application now has a new resource - reviews. You‚Äôve defined a relationship between these two resources in your application. A book can have many reviews, and review belongs to a book.</p>

    <p>We can define this relationship in your routes file.</p>
  </li>
  <li>
    <p>In your routes file, change</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">resources</span> <span class="ss">:books</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:reviews</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>  <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
    <span class="c1"># For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html</span>
    <span class="n">root</span> <span class="s2">"books#index"</span>

    <span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="ss">:reviews</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Let‚Äôs see how that changed your application‚Äôs routes.</p>

<ol>
  <li>
    <p>Open Terminal, go to the <code class="highlighter-rouge">bookstore</code> directory, and run <code class="highlighter-rouge">rake routes</code>.</p>

    <p>Whoa! Your application‚Äôs routing table got waaaaay bigger.</p>

    <p>Your application now has a bunch of review routes. Do you notice a pattern in their paths?</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>/books/:book_id/reviews
/books/:book_id/reviews
/books/:book_id/reviews/new
</code></pre>
    </div>

    <p>They all start with <code class="highlighter-rouge">/books/:book_id</code> because of the change you made to your application‚Äôs routes file:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:reviews</span>
<span class="k">end</span>
</code></pre>
    </div>

    <p>By nesting <code class="highlighter-rouge">:reviews</code> inside of <code class="highlighter-rouge">:books</code>, you‚Äôre setting up all your review routes to go through the book they belong to.</p>

    <p>For example, instead of having a route to get all your application‚Äôs reviews (<code class="highlighter-rouge">/reviews</code>), you have a route to get all of a books reviews (<code class="highlighter-rouge">/books/:book_id/reviews</code>).</p>

    <p><em>Why are we doing this again?</em></p>

    <p>We‚Äôre setting up your application‚Äôs routes to reflect the <code class="highlighter-rouge">belongs_to/has_many</code> relationship that exists between books and reviews.</p>

    <p>It might feel a little abstract, but this will come in handy when we‚Äôre adding reviews.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ <span class="nb">pwd</span>
  /Users/alimi/Projects/bookstore

  ‚Ä∫ rake routes
            Prefix Verb   URI Pattern                                Controller#Action
              root GET    /                                          books#index
      book_reviews GET    /books/:book_id/reviews<span class="o">(</span>.:format<span class="o">)</span>          reviews#index
                   POST   /books/:book_id/reviews<span class="o">(</span>.:format<span class="o">)</span>          reviews#create
   new_book_review GET    /books/:book_id/reviews/new<span class="o">(</span>.:format<span class="o">)</span>      reviews#new
  edit_book_review GET    /books/:book_id/reviews/:id/edit<span class="o">(</span>.:format<span class="o">)</span> reviews#edit
       book_review GET    /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#show
                   PATCH  /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#update
                   PUT    /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#update
                   DELETE /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#destroy
             books GET    /books<span class="o">(</span>.:format<span class="o">)</span>                           books#index
                   POST   /books<span class="o">(</span>.:format<span class="o">)</span>                           books#create
          new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>                       books#new
         edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span>                  books#edit
              book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#show
                   PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#update
                   PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#update
                   DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#destroy</code></pre></figure>

</div>

<div class="aside">
<h3 id="what-route-do-we-use-to-add-reviews">What Route Do We Use to Add Reviews?</h3>

<p>Given the changes to your application‚Äôs routes, what route would we use to add new reviews?</p>

<p>One route stands out:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>new_book_review GET    /books/:book_id/reviews/new<span class="o">(</span>.:format<span class="o">)</span>      reviews#new
</code></pre>
</div>

<p>I mean‚Ä¶it has a prefix of <code class="highlighter-rouge">new_book_review</code>. üòâ</p>

<p>Let‚Äôs try visiting that path.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Start your application‚Äôs web server, and go to <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>. Since the path starts with <code class="highlighter-rouge">/books/1</code>, this is where we‚Äôd go to add a review for your first book.</p>

    <p>Those errors sure do get old, don‚Äôt they‚Ä¶</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ rails server
  <span class="o">=</span>&gt; Booting Puma
  <span class="o">=</span>&gt; Rails 5.0.0.1 application starting <span class="k">in </span>development on http://localhost:3000</code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/review_controller_routing_error.png" alt="Browser showing Routing Error: &quot;uninitialized constant ReviewsController&quot;" class="screenshot" /></p>

<div class="aside">
<p>You got a <code class="highlighter-rouge">Routing Error</code> with a message that says ‚Äúuninitialized constant ReviewsController‚Äù. Any ideas why you‚Äôre seeing that error?</p>

<p>‚Ä¶</p>

<p>You don‚Äôt have a <code class="highlighter-rouge">ReviewsController</code>!</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Go back to Terminal, stop your application‚Äôs web server, and run the following command:</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>touch app/controllers/reviews_controller.rb
</code></pre>
    </div>

    <p>This will create an empty file named <code class="highlighter-rouge">app/controllers/reviews_controller.rb</code>.</p>
  </li>
  <li>
    <p>Restart your application‚Äôs web server, and open <code class="highlighter-rouge">app/controllers/reviews_controller.rb</code> in your text editor.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">‚Ä∫ rails server
<span class="gp">=&gt; </span>Booting Puma
...
^CExiting

‚Ä∫ touch app/controllers/reviews_controller.rb

‚Ä∫ rails server
<span class="gp">=&gt; </span>Booting Puma</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now you have a file for the <code class="highlighter-rouge">ReviewsController</code>, but you still haven‚Äôt defined it.</p>
  </li>
  <li>
    <p>Add the following code to <code class="highlighter-rouge">app/controllers/reviews_controller.rb</code></p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/reviews_new.png" alt="Browser showing Unknown action error: &quot;The action 'new' could not be found for ReviewsController&quot;" class="screenshot" /></p>

<div class="aside">
<p>Another error, but we know how to deal with these.</p>

<p>Right?!</p>

<p><img src="/rails_tutorial/assets/images/fake-it.jpg" alt="Fake it 'til you make it" /></p>

<p>You‚Äôre seeing an <code class="highlighter-rouge">Unknown action</code> error that says ‚ÄúThe action ‚Äònew‚Äô could not be found for ReviewsController‚Äù. How would you fix this error?</p>

<p>The <code class="highlighter-rouge">ReviewsController</code> needs a <code class="highlighter-rouge">new</code> action!</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Add an empty <code class="highlighter-rouge">new</code> method to the <code class="highlighter-rouge">ReviewsController</code>.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/missing_reviews_template.png" alt="Browser showing ActionController::UnknownFormat error: &quot;ReviewsController#new is missing a template for this request format and variant.&quot;" class="screenshot" /></p>

<div class="aside">
<p>You have a <code class="highlighter-rouge">ReviewsController</code> that has a <code class="highlighter-rouge">new</code> method, but you‚Äôre <em>still</em> getting an error when you visit the new reviews path (<a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>).</p>

<p>The <code class="highlighter-rouge">ActionController::UnknownFormat</code> error might seem intense, but do you remember seeing it before? There‚Äôs one key piece of information burried in the weeds.</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>ReviewsController#new is missing a template for this request format and variant.
</code></pre>
</div>

<p>We‚Äôre missing a template!</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>First, go back to Terminal and stop your application‚Äôs web server.</p>
  </li>
  <li>
    <p>Now, you‚Äôll need to create directory for the review templates. Run the following command:</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>mkdir app/views/reviews
</code></pre>
    </div>

    <p>This created an empty <code class="highlighter-rouge">reviews</code> directory inside of <code class="highlighter-rouge">app/views</code>.</p>
  </li>
  <li>
    <p>Then, you can create the new reviews template with the following command:</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>touch app/views/reviews/new.html.erb
</code></pre>
    </div>
  </li>
  <li>
    <p>Restart your application‚Äôs web server, and try going back to <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>.</p>

    <p>What do you think will happen?</p>

    <p><img src="/rails_tutorial/assets/images/fingers-crossed.gif" alt="Fingers crossed!" /></p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ rails server
  ...
  ^CExiting

  ‚Ä∫ mkdir app/views/reviews

  ‚Ä∫ touch app/views/reviews/new.html.erb

  ‚Ä∫ rails server
  <span class="o">=</span>&gt; Booting Puma
  <span class="o">=</span>&gt; Rails 5.0.0.1 application starting <span class="k">in </span>development on http://localhost:3000</code></pre></figure>

</div>

<div class="aside">
<p>Have you ever been so excited to see a blank page?!</p>

<p>Please, contain your excitement!</p>

<p><img src="/rails_tutorial/assets/images/not-excited.gif" alt="Someone's not excited" /></p>

<p>We‚Äôre rendering a blank page for the new reviews page, but what should we be rendering instead?</p>

<p>We‚Äôre going to follow the same we pattern we used back in Chapter 5 to add books.</p>

<p>To add a book, you start by visiting the new book page (<a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>). When you get there, you see a form where you can enter data for the new book you want to add.</p>

<p><img src="/rails_tutorial/assets/images/remember_new_book.png" alt="Browser showing new book page" class="screenshot" /></p>

<p>When you‚Äôre done adding the data for the new book, you click on ‚ÄúCreate Book‚Äù to add the new book.</p>

<p>We‚Äôre going to repeat this workflow, but instead of creating a book we‚Äôre going to create a <em>review</em> for a given book.</p>
</div>

<div class="steps">
<div class="list">
<p>Let‚Äôs get started by showing the title of the book that‚Äôs being reviewed at the top of the page.</p>

<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">ReviewsController</code> in your text editor, and add the following code to <code class="highlighter-rouge">new</code> method.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
</code></pre>
    </div>

    <p>This will make the book‚Äôs data available in the new review template.</p>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now, open <code class="highlighter-rouge">app/views/reviews/new.html.erb</code> and add the following line:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span> New review for <span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/h1&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>.</p>

    <p>The top of the page should have a message that says ‚ÄúNew review for why‚Äôs (poignant) Guide to Ruby‚Äù.</p>
  </li>
  <li>
    <p>Try visiting the new review path for different books in your bookstore.</p>

    <p>For example, to visit the new review path for the second book in your bookstore you would go to <a href="http://localhost:3000/books/2/reviews/new">http://localhost:3000/books/2/reviews/new</a>.</p>

    <p>As you go to different paths, the message at the top of the page should change to show that book‚Äôs title.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>  <span class="nt">&lt;h1&gt;</span> New Review for <span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/h1&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Now, we need to make the new review form.</p>

<p>To get started, we‚Äôll update the <code class="highlighter-rouge">ReviewsController</code> <code class="highlighter-rouge">new</code> method to make a new review available in the new review template.</p>

<p><em>That‚Äôs a lot of new</em> üòÖ</p>

<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">ReviewsController</code> and add the following line at the end of the <code class="highlighter-rouge">new</code> method.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="vi">@review</span> <span class="o">=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">build</span>
</code></pre>
    </div>

    <p>This will create an empty review for the book that we can use in the new review template.</p>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="vi">@review</span> <span class="o">=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">build</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Now, we can build the review form!</p>

<p><img src="/rails_tutorial/assets/images/excited.gif" alt="Jake and Finn are excited!" /></p>

<ol>
  <li>
    <p>This form is going to be pretty simmilar to the new book form, but with less fields.</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Using the new book form as an example, add a new review form to <code class="highlighter-rouge">app/views/reviews/new.html.erb</code>. The only field you need to set on a review is its body.</p>

    <p>When you‚Äôre done, try add a review!</p>

    <p><em>Psst‚Ä¶not to be a downer, but chances are your solution won‚Äôt work</em></p>
  </li>
</ol>
</div>
</div>

<div class="aside">
<p>What did you come up with? If you‚Äôre anything like me, you followed the pattern in the new book form and came up with something like this:</p>

<div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@review</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>

<p>For some reason, that doesn‚Äôt work. This solution leads to an error‚Ä¶</p>

<p><img src="/rails_tutorial/assets/images/new_review_unknown_path.png" alt="Browser showing NoMethodError in Reviews#new: &quot;undefined method `reviews_path'&quot;" class="screenshot" /></p>

<p>This is a tricky error, but the gist of it is that we have an undefined method for <code class="highlighter-rouge">reviews_path</code>.</p>

<p>By doing <code class="highlighter-rouge">&lt;%= form_for(@review) do |f| %&gt;</code>, we‚Äôre creating a form for a new review that will get submitted to the <code class="highlighter-rouge">reviews_path</code>. What‚Äôs wrong with that?</p>

<p>We don‚Äôt have a <code class="highlighter-rouge">reviews_path</code>‚Ä¶we have a <code class="highlighter-rouge">book_reviews_path</code>.</p>

<p>Do you remember what your application‚Äôs routes file looks like?</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="c1"># For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html</span>
  <span class="n">root</span> <span class="s2">"books#index"</span>

  <span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:reviews</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Reviews are resources nested under books. Therefore, all review routes have to be referenced through a book.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>To make the new review form work, we need to change</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@review</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">([</span><span class="vi">@book</span><span class="p">,</span> <span class="vi">@review</span><span class="p">])</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>With this change, the form will use the <code class="highlighter-rouge">book_reviews_path</code> instead of the invalid <code class="highlighter-rouge">reviews_path</code>.</p>
  </li>
  <li>
    <p>Your form should now look like this:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">([</span><span class="vi">@book</span><span class="p">,</span> <span class="vi">@review</span><span class="p">])</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>Update your form to match this solution.</p>
  </li>
  <li>
    <p>Save your changes and try adding a review to your first book by visiting <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre>  <span class="nt">&lt;h1&gt;</span> New Review for <span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/h1&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">([</span><span class="vi">@book</span><span class="p">,</span> <span class="vi">@review</span><span class="p">])</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/unknownaction_create.png" alt="Browser showing an Unknown action error when trying to add a review" class="screenshot" /></p>

<div class="aside">
<p>An <code class="highlighter-rouge">Unknown action</code> error?! But we were so close!!!</p>

<p><img src="/rails_tutorial/assets/images/upset.gif" alt="Jake is upset" /></p>

<p>Don‚Äôt be so down! We‚Äôve gotten through this before‚Ä¶we can fix this.</p>

<p><img src="/rails_tutorial/assets/images/fix-it.gif" alt="Fix it!" /></p>

<p>The error is telling us what we need to do.</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>The action 'create' could not be found for ReviewsController.
</code></pre>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Add an empty <code class="highlighter-rouge">create</code> method to the <code class="highlighter-rouge">ReviewsController</code>.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes and try adding a review for your first book again by visiting <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="vi">@review</span> <span class="o">=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">build</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<p>Nothing happened, right?</p>

<p>RIGHT?!?</p>

<p>Of course nothing happened, the <code class="highlighter-rouge">create</code> method is empty.</p>

<p>We need to update the <code class="highlighter-rouge">ReviewsController</code> <code class="highlighter-rouge">create</code> method so it creates a review for the requested book.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Add the followling lines to the <code class="highlighter-rouge">ReviewsController</code> <code class="highlighter-rouge">create</code> method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
<span class="n">book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre>
    </div>

    <p>First, we find the requested book and assign it to a variable called <code class="highlighter-rouge">book</code>. Then, we create a review for the book using the data that was sent with the form. The data is available in the params hash.</p>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>, and try adding a review one more time.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="vi">@review</span> <span class="o">=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">build</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="n">book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/reviews_forbidden.png" alt="Browser showing ActiveModel::ForbiddenAttributesError in ReviewsController#create" class="screenshot" /></p>

<div class="aside">
<p>Are you really surprised to see another error? üòâ</p>

<p>What do you think is going on? You‚Äôre getting an <code class="highlighter-rouge">ActiveModel::ForbiddenAttributesError</code>, but why?</p>

<p>If you look closely at the browser, Rails is telling you <em>where</em> the problem is. It‚Äôs inside the <code class="highlighter-rouge">create</code> method.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre>
</div>

<p>Why would you get an <code class="highlighter-rouge">ActiveModel::ForbiddenAttributesError</code> from doing <code class="highlighter-rouge">book.reviews.create(params)</code>‚Ä¶ü§î</p>

<p>Check out the <code class="highlighter-rouge">ActiveModel::ForbiddenAttributesError</code> <a href="http://api.rubyonrails.org/v5.0.0/classes/ActiveModel/ForbiddenAttributesError.html">doc</a>. What does the description say?</p>

<blockquote>
  <p><em>Raised when forbidden attributes are used for mass assignment.</em></p>
</blockquote>

<p>Ah! We‚Äôre trying to create the review using all the data from the params hash, but we haven‚Äôt allowed any attributes to be set. This is that security feature we looked at earlier called <a href="http://guides.rubyonrails.org/action_controller_overview.html#strong-parameters">strong parameters</a>.</p>

<p>Strong parameters forces us to explcitly state what attributes can be set to prevent malicious data from entering our applications. When you try to assign attributes that haven‚Äôt been permitted, you get an <code class="highlighter-rouge">ActiveModel::ForbiddenAttributesError</code> error.</p>
</div>

<div class="steps">
<div class="list">
<p>To fix the <code class="highlighter-rouge">ReviewsController</code> <code class="highlighter-rouge">create</code> method, we need to specify the attributes that can be set on reviews. There is only one attribute we care about - <code class="highlighter-rouge">body</code>.</p>

<ol>
  <li>
    <p>Add the following method to the end of the <code class="highlighter-rouge">ReviewsController</code>:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">review_params</span>
  <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:review</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:body</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
    </div>

    <p>Inside this <code class="highlighter-rouge">review_params</code> method, we‚Äôre saying the <code class="highlighter-rouge">params</code> hash must have a <code class="highlighter-rouge">review</code> hash. Inside the <code class="highlighter-rouge">review</code> hash, we‚Äôll allow a <code class="highlighter-rouge">body</code> attribute to be used on a new review.</p>
  </li>
  <li>
    <p>Do you remember what the <code class="highlighter-rouge">params</code> hash looks like? It looks something like this:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="s2">"utf8"</span><span class="o">=&gt;</span><span class="s2">"‚úì"</span><span class="p">,</span> <span class="s2">"authenticity_token"</span><span class="o">=&gt;</span><span class="s2">"JYZD9Lsnb6RbMX7OW/QUXNY6Uzxd0MYZNcDKHKZjAmggVeGwKb6lPkOE60zgptRlquzdhJo9tOU5r7mLthxXog=="</span><span class="p">,</span> <span class="s2">"review"</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">"body"</span><span class="o">=&gt;</span><span class="s2">"Wooooooooo"</span><span class="p">},</span> <span class="s2">"commit"</span><span class="o">=&gt;</span><span class="s2">"Create Review"</span><span class="p">,</span> <span class="s2">"book_id"</span><span class="o">=&gt;</span><span class="s2">"1"</span><span class="p">}</span>
</code></pre>
    </div>

    <p>There‚Äôs a bunch of stuff in there, but now we‚Äôre restricted to only using the <code class="highlighter-rouge">body</code> attribute from the <code class="highlighter-rouge">review</code> hash.</p>
  </li>
  <li>
    <p>Now we can use <code class="highlighter-rouge">review_params</code> inside the <code class="highlighter-rouge">create</code> method. Replace</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</code></pre>
    </div>

    <p>with</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">review_params</span><span class="p">)</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>, and try adding a review!</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="vi">@review</span> <span class="o">=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">build</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="n">book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">review_params</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">review_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:review</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Nothing happened‚Ä¶or did it?</p>

<ol>
  <li>
    <p>Go back to your first book‚Äôs details page at <a href="http://localhost:3000/books/1">http://localhost:3000/books/1</a>.</p>

    <p>Notice anything different???</p>

    <p>Your new review!!! üéâ</p>
  </li>
  <li>
    <p>Nothing happens at the end of the <code class="highlighter-rouge">ReviewsController</code> <code class="highlighter-rouge">create</code> method so it feels like your review wasn‚Äôt created. Let‚Äôs fix this.</p>

    <p>Add the following line to the end of the <code class="highlighter-rouge">ReviewsController</code> <code class="highlighter-rouge">create</code> method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">redirect_to</span> <span class="n">book_path</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
</code></pre>
    </div>

    <p>After a review is added for the book, we‚Äôll redirect to the book details page for the book so we can verify the new review was created.</p>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/1/reviews/new">http://localhost:3000/books/1/reviews/new</a>, and watch what happens when you add a new review.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">ReviewsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="vi">@review</span> <span class="o">=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">build</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book_id</span><span class="p">])</span>
      <span class="n">book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">review_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">book_path</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">review_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:review</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<p>You‚Äôve done <em>a lot</em> of work in this chapter, but look at your bookstore! Now you can write all those book reviews you‚Äôve been putting off for all these years.</p>

<p><img src="/rails_tutorial/assets/images/typing.gif" alt="Typing!" /></p>

<p>Before you jump into writing those reviews, let‚Äôs clean up <em>one</em> more thing‚Ä¶</p>
</div>

<div class="steps">
<div class="list">
<p>To create a review for a book, you have to know the URL you want to visit. We can make this a little nicer by adding a link to the new review page from the book details pages.</p>

<p>You‚Äôll be able to quickly write a review for the book you‚Äôre looking at.</p>

<ol>
  <li>
    <p>Let‚Äôs start by looking at your application‚Äôs routes. Go to Terminal, stop your application‚Äôs web server, and run <code class="highlighter-rouge">rake routes</code>.</p>

    <p>Which row has the path we‚Äôve been using to get to the new review page?</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>new_book_review GET    /books/:book_id/reviews/new<span class="o">(</span>.:format<span class="o">)</span>      reviews#new
</code></pre>
    </div>

    <p>The first column in the row is a <code class="highlighter-rouge">prefix</code>. The new review page has a <code class="highlighter-rouge">prefix</code> of <code class="highlighter-rouge">new_book_review</code>. We‚Äôll use this <code class="highlighter-rouge">prefix</code> to build a link to the new review path.</p>
  </li>
  <li>
    <p>Restart your application‚Äôs web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ rails server
  <span class="o">=</span>&gt; Booting Puma
  ...
  ^CExiting

  ‚Ä∫ rake routes
            Prefix Verb   URI Pattern                                Controller#Action
              root GET    /                                          books#index
      book_reviews GET    /books/:book_id/reviews<span class="o">(</span>.:format<span class="o">)</span>          reviews#index
                   POST   /books/:book_id/reviews<span class="o">(</span>.:format<span class="o">)</span>          reviews#create
   new_book_review GET    /books/:book_id/reviews/new<span class="o">(</span>.:format<span class="o">)</span>      reviews#new
  edit_book_review GET    /books/:book_id/reviews/:id/edit<span class="o">(</span>.:format<span class="o">)</span> reviews#edit
       book_review GET    /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#show
                   PATCH  /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#update
                   PUT    /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#update
                   DELETE /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#destroy
             books GET    /books<span class="o">(</span>.:format<span class="o">)</span>                           books#index
                   POST   /books<span class="o">(</span>.:format<span class="o">)</span>                           books#create
          new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>                       books#new
         edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span>                  books#edit
              book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#show
                   PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#update
                   PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#update
                   DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#destroy

  ‚Ä∫ rails server
  <span class="o">=</span>&gt; Booting Puma
  ...</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now, open <code class="highlighter-rouge">app/views/books/show.html.erb</code> in your text editor.</p>
  </li>
  <li>
    <p>Find the ‚ÄúEdit book‚Äù link.</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">"Edit book"</span><span class="p">,</span> <span class="n">edit_book_path</span><span class="p">(</span><span class="vi">@book</span><span class="p">),</span> <span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>After the link ‚ÄúEdit book‚Äù link, add a link to ‚ÄúAdd a Review‚Äù.</p>

    <p>The link should say ‚ÄúAdd a Review‚Äù. It should link to the <code class="highlighter-rouge">new_book_review_path</code> for <code class="highlighter-rouge">@book</code>, and it should have a ‚Äúbutton‚Äù class so it gets styled like an actionable element.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>What did you come up with?</p>

    <p>The link should look something like this:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">"Add a Review"</span><span class="p">,</span> <span class="n">new_book_review_path</span><span class="p">(</span><span class="vi">@book</span><span class="p">),</span> <span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Update your solution to match this solution.</p>
  </li>
  <li>
    <p>Save your changes, find some books, and review them!</p>
  </li>
  <li>
    <p>When you‚Äôre done writing reviews, stop your application‚Äôs web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></td><td class="code"><pre>  <span class="nt">&lt;dl&gt;</span>
    <span class="nt">&lt;dt&gt;</span>Id<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Title<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Author<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">author</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Price<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="n">number_to_currency</span><span class="p">(</span><span class="vi">@book</span><span class="p">.</span><span class="nf">price_cents</span> <span class="o">/</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Quantity<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">quantity</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Description<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">description</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>
  <span class="nt">&lt;/dl&gt;</span>

  <span class="nt">&lt;p&gt;</span> Number of reviews: <span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">count</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">review</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span> <span class="cp">&lt;%=</span> <span class="n">review</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">"Edit book"</span><span class="p">,</span> <span class="n">edit_book_path</span><span class="p">(</span><span class="vi">@book</span><span class="p">),</span> <span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">"Add a Review"</span><span class="p">,</span> <span class="n">new_book_review_path</span><span class="p">(</span><span class="vi">@book</span><span class="p">),</span> <span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">button_to</span><span class="p">(</span><span class="s2">"Delete Book"</span><span class="p">,</span> <span class="n">book_path</span><span class="p">(</span><span class="vi">@book</span><span class="p">),</span> <span class="ss">method: :delete</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"button danger"</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/review_button.png" alt="Browser showing book details page with a link to &quot;Add a Review&quot;" class="screenshot" /></p>

      <div class="tutorial-button-group">
  
    
      <a href="/rails_tutorial/tutorial/chapter_10/" target="_self">
        <div class="back-button">
          Chapter 10
        </div>
      </a>
    
    
      <a href="/rails_tutorial/tutorial/chapter_12/" target="_self">
        <div class="next-button">
          Chapter 12
        </div>
      </a>
    
  
</div>

    </div>
  </div>
<footer>
  <div class="container">
    <a href="http://bmoreonrails.org/">
      <img src="/rails_tutorial/assets/icons/bmore.png">
    </a>

    <a rel="license" href="/rails_tutorial/license" target="_self">
      <img class="icon"
           alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License"
           src="/rails_tutorial/assets/icons/cc-by-nc-sa.svg"
      />
    </a>

    <a href="https://github.com/bmoreonrails/rails_tutorial">
      <img class="icon"
           alt="Rails Tutorial on GitHub"
           src="/rails_tutorial/assets/icons/github.png"
      />
    </a>

    <a href="https://twitter.com/BmorRailsSchool">
      <img class="icon"
           alt="B'more on Rails School on Twitter"
           src="/rails_tutorial/assets/icons/twitter.png"
      />
    </a>
  </div>
</footer>
</body>
</html>


<script>

$('img.screenshot').featherlight({
    targetAttr: 'src'
});

</script>
