<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
      <base target="_blank"/>
    
    <title>B'more on Rails Workshop for Women</title>
    <link href="/rails_tutorial/css/syntax/monokai.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/css/base.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/assets/vendor/css/featherlight.min.css" type="text/css" rel="stylesheet">
    <script src="/rails_tutorial/js/jquery.min.js"></script>
    <script src="/rails_tutorial/assets/vendor/js/featherlight.min.js"></script>
    <script src="/rails_tutorial/js/tutorial_nav.js"></script>
    <script src="/rails_tutorial/js/progress.js"></script>
  </head>

<body>
  <div class="container" data-chapter="6">
    <nav>
      
<div class="tutorial_nav">
  <div class="progress"><div class="progress_bar"></div></div>
  <ul id="menu-list">
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_01/" target="_self">
        1 Getting Started from Scratch
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_02/" target="_self">
        2 Creating the First Table in Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_03/" target="_self">
        3 Viewing Data in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_04/" target="_self">
        4 Showing Detailed Information in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_05/" target="_self">
        5 Creating Books Through the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_06/" target="_self">
        6 Updating Books
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_07/" target="_self">
        7 Styling Your Bookstore
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_08/" target="_self">
        8 Deleting a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_09/" target="_self">
        9 Reviewing a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_10/" target="_self">
        10 Showing Reviews
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_11/" target="_self">
        11 Adding Reviews from the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_12/" target="_self">
        12 Adding Users to Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_13/" target="_self">
        13 Logging In and Logging Out
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_14/" target="_self">
        14 Logged In vs Logged Out Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_15/" target="_self">
        15 Associating Reviews with Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_16/" target="_self">
        16 The End!
       </a>
     </li>
    
   </ul>

  <div class="menu">
    <div class="hamburger-icon" data-toggle="#menu-list"> &#9776</div>
    <div class="menu-title" data-toggle="#menu-list">Chapter 6 -- Updating Books</div>
    <div class="menu-title"><a href="/rails_tutorial/" target="_self">Home</a></div>
  </div>
</div>

    </nav>
    <div class="content">
      <div class="sectionheader">
<p>Updating Books</p>
</div>

<div class="aside">
<p>You have so many books in your bookstore! 🎉</p>

<p>What would happen if you suddenly sold every copy of a book? What about if the price changes?</p>

<p>You’d have to open <code class="highlighter-rouge">rails console</code> to change your book’s data. That doesn’t sound very great.</p>

<p>What if you could update books in your browser? Wouldn’t that be a little easier?</p>

<p>Let’s make it so you can can update books in the browser.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open Terminal and go to your <code class="highlighter-rouge">bookstore</code> directory. Then, run <code class="highlighter-rouge">rake routes</code>.</p>
  </li>
  <li>
    <p>Now that we want to edit and update books, a couple of rows in the routing table should stand out.</p>

    <p>First, take a look at the row with <code class="highlighter-rouge">edit_book</code>.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span> books#edit
</code></pre>
    </div>

    <p>The path to <code class="highlighter-rouge">edit_book</code> is <code class="highlighter-rouge">/books/:id/edit</code>. Doesn’t that look a little familiar? You’ve been going to <code class="highlighter-rouge">/books/:id</code> to see the details for a given book. Now, you’ll go to <code class="highlighter-rouge">/books/:id/edit</code> to edit the given book.</p>
  </li>
  <li>
    <p>Start your application’s web server and go to <a href="http://localhost:3000/books">http://localhost:3000/books</a>. From the index, click the link for <em>why’s (poignant) Guide to Ruby</em>.</p>

    <p>Your browser should have URL of <code class="highlighter-rouge">http://localhost:3000/books/1</code> in its address bar. Edit the URL so it’s <code class="highlighter-rouge">http://localhost:3000/books/1/edit</code> to visit the edit path for <em>why’s (poignant) Guide to Ruby</em>. Now, try going to the new URL.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span><span class="nb">pwd</span>
  /Users/awesomesauce/Projects/bookstore

  <span class="nv">$ </span>rake routes
     Prefix Verb   URI Pattern               Controller#Action
      books GET    /books<span class="o">(</span>.:format<span class="o">)</span>          books#index
            POST   /books<span class="o">(</span>.:format<span class="o">)</span>          books#create
   new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>      books#new
  edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span> books#edit
       book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#show
            PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#destroy

  <span class="nv">$ </span>rails server
  <span class="o">=</span>&gt; Booting Puma</code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/unknown_action_edit.png" alt="Browser showing `/books/1/edit` with an Unknown action error: &quot;The action 'edit' could not be found for BooksController&quot;" class="screenshot" /></p>

<div class="aside">
<p>You got an error, right?</p>

<p>Good.</p>

<p>Can you guess why you’re seeing an <code class="highlighter-rouge">Unknown action</code> error?</p>
</div>

<div class="steps">
<div class="list">
<p>You’re getting an <code class="highlighter-rouge">Unknown action</code> error because your <code class="highlighter-rouge">BooksController</code> doesn’t have an <code class="highlighter-rouge">edit</code> method. Let’s add it.</p>

<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor. Add the <code class="highlighter-rouge">edit</code> method to the end of the controller.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">edit</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Try going to <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a> again.</p>

    <p>What do you think will happen?</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">edit</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/UnknownFormat_in_BooksController_edit.png" alt="Browser showing ActionController::UnknownFormat error: &quot;BooksController#edit is missing a template for this request format and variant&quot;" class="screenshot" /></p>

<div class="aside">
<p>Did you guess you’d see an <code class="highlighter-rouge">ActionController::UnknownFormat</code> error? Me either. 😅</p>

<p>However, you might have guessed that the request was going to error. You added the <code class="highlighter-rouge">edit</code> action to the <code class="highlighter-rouge">BooksController</code>, but it doesn’t have a template to render.</p>

<p>Let’s add it.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Go back to Terminal and stop your application’s web server.</p>
  </li>
  <li>
    <p>Run <code class="highlighter-rouge">touch app/views/books/edit.html.erb</code> to create the edit book template.</p>
  </li>
  <li>
    <p>Restart your application’s web server and revisit <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a>.</p>

    <p>A blank page has never looked better!</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>rails server
  ...
  ^CExiting

  <span class="nv">$ </span>touch app/views/books/edit.html.erb

  <span class="nv">$ </span>rails server</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>In the edit template, we’ll take advantage of forms again. We’ll use them to gather new book data.</p>

<p>Before we add the form to the template, let’s make some of the existing book data available.</p>

<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> and add the following line inside the <code class="highlighter-rouge">edit</code> method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
</code></pre>
    </div>

    <p>(Doesn’t that look a lot like the <code class="highlighter-rouge">show</code> method?)</p>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">edit</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<p>The edit book form is going be similiar to the new book form.</p>

<p>Remember what the new book form looked like?</p>

<div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
</div>

<div class="steps">
<div class="list">
<p>Let’s start the edit book form by adding a field to edit the book’s title.</p>

<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/views/books/edit.html.erb</code> in your text editor and add the following:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes and revist <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a>.</p>
  </li>
</ol>
</div>
</div>

<p><img src="/rails_tutorial/assets/images/edit_field_for_title.png" alt="Browser showing &quot;/books/1/edit&quot; with a filled-in text_field for the book's title" class="screenshot" /></p>

<div class="aside">
<p>Whoa! The title is already filled-in!</p>

<p>In the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">edit</code> method, you found the requested book in your database and assigned it to <code class="highlighter-rouge">@book</code>. When you called <code class="highlighter-rouge">form_for</code> in <code class="highlighter-rouge">app/views/books/edit.html.erb</code>, you passed it <code class="highlighter-rouge">@book</code>.</p>

<p>Since <code class="highlighter-rouge">@book</code> is a book in your database with a title, the title <code class="highlighter-rouge">text_field</code> was populated with <code class="highlighter-rouge">@book</code>’s title.</p>

<p>(<a href="https://www.youtube.com/watch?v=MzlK0OGpIRs"><em>Magic</em></a>)</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Update the form so it has fields for all the book attributes: title, author, price_cents, quantity, and description.</p>

    <p>Use the new book form in <code class="highlighter-rouge">app/views/books/new.html.erb</code> as an example.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>How’s your form look? It should look like this:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Update your solution to match this solution. Save your changes and revisit <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="k">if</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/all_the_edit_fields.png" alt="Browser showing &quot;/books/1/edit&quot; with a form but no button" class="screenshot" /></p>

<div class="aside">
<p>Now you can edit all your book data, but there’s no way to save your changes.</p>

<p>We need to add a <code class="highlighter-rouge">submit</code> button so you can submit your changes via the form.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/views/books/edit.html.erb</code> and add a <code class="highlighter-rouge">submit</code> button as the last line inside the <code class="highlighter-rouge">form_for</code> block.</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>This will add a button to your form labeled “Update Book”. <em>Magic</em></p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a>. Try making a change and submitting the form.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:quantity</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:description</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/update_form_with_button.png" alt="Browser showing &quot;/books/1/edit&quot; with a submit button" class="screenshot" /></p>

<p><img src="/rails_tutorial/assets/images/unknown_action_update.png" alt="Browser showing Unknown action error: &quot;The action 'update' could not be found for BooksController&quot;" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>We’ve been through this drill before…</p>

<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> and add an <code class="highlighter-rouge">update</code> method to the end of it.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a>. Try making a change to the book and submitting the form.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">edit</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">update</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Nothing happened!</p>

<p>The form is being submitted to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">update</code> method, and the method is…empty. I think I’d be more surprised if something <em>did</em> happen. 😉</p>

<p>The <code class="highlighter-rouge">update</code> method should probably do something. Maybe it should update the book.</p>

<ol>
  <li>
    <p>First, let’s find the book you’re trying to update.</p>

    <p>Open the <code class="highlighter-rouge">BooksController</code> and add the following line insided the <code class="highlighter-rouge">update</code> method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
</code></pre>
    </div>

    <p>We’ve done this in a few of the <code class="highlighter-rouge">BooksController</code> methods.</p>

    <p>Now that we have the book, how will we <code class="highlighter-rouge">update</code> it?</p>

    <p>You’ve updated books before. Do you remember when you added descriptions to all your books? How did you do it?</p>

    <p>You did something along the lines of <code class="highlighter-rouge">my_first_book.update(description: "Woooo")</code>.</p>

    <p>You called the <code class="highlighter-rouge">update</code> method on each of your books to give them descriptions. We’ll use <code class="highlighter-rouge">update</code> again to make the requested changes.</p>
  </li>
  <li>
    <p>We could simply do <code class="highlighter-rouge">book.update(params[:book])</code>, but that won’t work because of strong parameters.</p>

    <p>Instead, add the following line to the end of the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">update</code> method.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">book</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a>, make some changes, and submit that form!</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">edit</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">update</span>
      <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
      <span class="n">book</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<h3 id="where-are-my-changes">Where are my changes?!</h3>

<p>Nothing happened, right?</p>

<p>Go to <a href="http://localhost:3000/books/1">http://localhost:3000/books/1</a>, and make sure to refresh the page.</p>

<p>Your change is there!</p>

<p>Don’t believe me? Try making another change?</p>

<p>How are changes happening when it looks like the form isn’t being submitted?</p>

<p>The form is being submitted to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">update</code> method, and the requested changes are being made to the book. But that’s where the <code class="highlighter-rouge">update</code> method ends. It looks like nothing happened because there’s no visual queue that something happened.</p>

<p>After a book is updated, let’s redirect to that book’s details. That way, we can see the changes.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>At the end of the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">update</code> method, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">redirect_to</span> <span class="n">book_path</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/1/edit">http://localhost:3000/books/1/edit</a>, and try making another change. When you submit your changes, you should be redirected to the first book’s details. Keep an out to see your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">edit</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">update</span>
      <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
      <span class="n">book</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">book_path</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<p>Yay! In addition to adding books from the browser, you can now edit books too.</p>

<p>Before we move on, let’s take a look at cleaning up some stuff. Let’s start with the <code class="highlighter-rouge">BooksController</code>.</p>

<p>In both the <code class="highlighter-rouge">create</code> and <code class="highlighter-rouge">update</code> methods of the <code class="highlighter-rouge">BooksController</code>, you’re authorizing and getting the same params.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>

<span class="p">.</span><span class="nf">.</span><span class="p">.</span>

<span class="nf">def</span> <span class="n">update</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">book</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
</div>

<p>Fortunately, there’s a convention to help manage this shared bit of code.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor, and add the following code to the end of it:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">book_params</span>
  <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
    </div>

    <p>By defining a new <code class="highlighter-rouge">book_params</code> method, we have one place to deal with getting and authorizing book params.</p>
  </li>
  <li>
    <p>Now, update the <code class="highlighter-rouge">create</code> method so it uses <code class="highlighter-rouge">book_params</code>. Change</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">book_params</span><span class="p">)</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Make the same change to the <code class="highlighter-rouge">update</code> method.</p>
  </li>
  <li>
    <p>Save your changes and try creating and editing books. Everything should still work the same as it did before these changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">book_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">edit</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">update</span>
      <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
      <span class="n">book</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">book_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">book_path</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">book_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Let’s make one more change to improve the edit workflow.</p>

<p>Right now, you can only edit books if you know the <code class="highlighter-rouge">edit_book_path</code> URL. Let’s make this a little user-friendly by adding a link to the edit page from the book show page.</p>

<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/views/books/show.html.erb</code> in your text editor. Add the following line to the end of the file:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit book"</span><span class="p">,</span> <span class="n">edit_book_path</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>This will create a link with text “Edit book”. It will link to the <code class="highlighter-rouge">edit_book_path</code> for <code class="highlighter-rouge">@book</code> which will evaluate to <code class="highlighter-rouge">/books/:id/edit</code>.</p>

    <p>Adding the link here works really well because we already have the book we want to edit as <code class="highlighter-rouge">@book</code>.</p>
  </li>
  <li>
    <p>Save your changes and visit a few books. Clicking the “Edit book” link should take you to the edit page for the book you’re viewing.</p>
  </li>
  <li>
    <p>When you’re done exploring, stop your application’s web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre>  <span class="nt">&lt;dl&gt;</span>
    <span class="nt">&lt;dt&gt;</span>Id<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Title<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Author<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">author</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Price<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="n">number_to_currency</span><span class="p">(</span><span class="vi">@book</span><span class="p">.</span><span class="nf">price_cents</span> <span class="o">/</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Quantity<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">quantity</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dt&gt;</span>Description<span class="nt">&lt;/dt&gt;</span>
    <span class="nt">&lt;dd&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@book</span><span class="p">.</span><span class="nf">description</span> <span class="cp">%&gt;</span><span class="nt">&lt;/dd&gt;</span>
  <span class="nt">&lt;/dl&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit book"</span><span class="p">,</span> <span class="n">edit_book_path</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

      <div class="tutorial-button-group">
  
    
      <a href="/rails_tutorial/tutorial/chapter_05/" target="_self">
        <div class="back-button">
          Chapter 5
        </div>
      </a>
    
    
      <a href="/rails_tutorial/tutorial/chapter_07/" target="_self">
        <div class="next-button">
          Chapter 7
        </div>
      </a>
    
  
</div>

    </div>
  </div>
<footer>
  <div class="container">
    <a href="http://bmoreonrails.org/">
      <img src="/rails_tutorial/assets/icons/bmore.png">
    </a>

    <a rel="license" href="/rails_tutorial/license" target="_self">
      <img class="icon"
           alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License"
           src="/rails_tutorial/assets/icons/cc-by-nc-sa.svg"
      />
    </a>

    <a href="https://github.com/bmoreonrails/rails_tutorial">
      <img class="icon"
           alt="Rails Tutorial on GitHub"
           src="/rails_tutorial/assets/icons/github.png"
      />
    </a>

    <a href="https://twitter.com/BmorRailsSchool">
      <img class="icon"
           alt="B'more on Rails School on Twitter"
           src="/rails_tutorial/assets/icons/twitter.png"
      />
    </a>
  </div>
</footer>
</body>
</html>


<script>

$('img.screenshot').featherlight({
    targetAttr: 'src'
});

</script>
