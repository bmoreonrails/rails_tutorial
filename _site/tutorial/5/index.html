<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>B'more on Rails Workshop for Women</title>
   <link href="/rails_tutorial/css/syntax.css" type="text/css" rel="stylesheet"/>
   <link href="/rails_tutorial/css/base.css" type="text/css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="/rails_tutorial/js/tutorial_nav.js"></script>
  </head>


<body>
  <div class="container">
    <nav>
      <p>
       
<div class="tutorial_nav">
  <ul id="menu-list">
    
     <li>
      <a href="/rails_tutorial/tutorial/1/">
        1 Getting Started from Scratch
       </a>
     </li>  
    
     <li>
      <a href="/rails_tutorial/tutorial/2/">
        2 Creating the First Table in Your Database
       </a>
     </li>  
    
     <li>
      <a href="/rails_tutorial/tutorial/3/">
        3 Viewing Data in the Browser
       </a>
     </li>  
    
     <li>
      <a href="/rails_tutorial/tutorial/4/">
        4 Showing Detailed Information in the Browser
       </a>
     </li>  
    
     <li>
      <a href="/rails_tutorial/tutorial/5/">
        5 Creating Books Through the Browser
       </a>
     </li>  
    
     <li>
      <a href="/rails_tutorial/tutorial/6/">
        6 Updating Books
       </a>
     </li>  
    
     <li>
      <a href="/rails_tutorial/tutorial/7/">
        7 Styling Your Bookstore
       </a>
     </li>  
    
   </ul>

  <div class="menu" data-toggle="#menu-list">
    <a href="#menu" class="hamburger">
      <div class="hamburger-icon"> &#9776</div>
      <div class="menu-title">Chapter 5 -- Creating Books Through the Browser</div>
    </a>
  </div>
</div>

      </p>
    </nav>
    <div class="content">
      <div class="sectionheader">
<p>Creating Books Through the Browser</p>
</div>

<div class="aside">
<p>So far you‚Äôve created books on the <code class="highlighter-rouge">rails console</code>. It works, but it‚Äôs not best experience. In most web applications, you enter data through‚Ä¶the web.</p>

<p>Your bookstore <em>is</em> a web application, so let‚Äôs treat it like one. Let‚Äôs set up your application so you can create books from your browser.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open Terminal and go to the <code class="highlighter-rouge">bookstore</code> directory.</p>
  </li>
  <li>
    <p>Now, run <code class="highlighter-rouge">rake routes</code>.</p>
  </li>
  <li>
    <p>We‚Äôve worked through a couple of the books routes. First, we used the <code class="highlighter-rouge">index</code> action to list all your application‚Äôs books. Then, we used the <code class="highlighter-rouge">show</code> action to show details for a given book.</p>

    <p>Now, we‚Äôll use the <code class="highlighter-rouge">new</code> action to create a new book.</p>
  </li>
  <li>
    <p>The path for the <code class="highlighter-rouge">new</code> action is <code class="highlighter-rouge">/books/new</code>.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>      books#new
</code></pre>
    </div>
  </li>
  <li>
    <p>Let‚Äôs try going to that path.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ <span class="nb">pwd</span>
  /Users/awesomesauce/Projects/bookstore

  ‚Ä∫ rake routes
     Prefix Verb   URI Pattern               Controller#Action
      books GET    /books<span class="o">(</span>.:format<span class="o">)</span>          books#index
            POST   /books<span class="o">(</span>.:format<span class="o">)</span>          books#create
   new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>      books#new
  edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span> books#edit
       book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#show
            PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#destroy</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In Terminal, start your application‚Äôs web server by running <code class="highlighter-rouge">rails server</code>.</p>
  </li>
  <li>
    <p>Now, try going to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>
  </li>
  <li>
    <p>You got an error, but doesn‚Äôt it look familiar?</p>

    <p>Why you think you got an Unknown action error?</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ rails server
  <span class="o">=</span>&gt; Booting Puma
  <span class="o">=</span>&gt; Rails 5.0.0.1 application starting <span class="k">in </span>development on http://localhost:3000
  <span class="o">=</span>&gt; Run <span class="sb">`</span>rails server -h<span class="sb">`</span> <span class="k">for </span>more startup options</code></pre></figure>

</div>

<p><img src="screenshot.jpg" alt="Browser showing Unknown action error: &quot;The action 'new' could not be found for BooksController&quot;" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>The error message gives you a hint as to why you‚Äôre getting an Unknown action error.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>The action 'new' could not be found for BooksController
</code></pre>
    </div>

    <p>When you make a request to <code class="highlighter-rouge">/books/new</code>, your request gets routed to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">new</code> action. What does your <code class="highlighter-rouge">BooksController</code> look like? Does it have a <code class="highlighter-rouge">new</code> action?</p>

    <p>The <code class="highlighter-rouge">BooksController</code> doesn‚Äôt have a <code class="highlighter-rouge">new</code> action because we haven‚Äôt defined it yet.</p>
  </li>
  <li>
    <p>In your text editor, open the <code class="highlighter-rouge">BooksController</code> (<code class="highlighter-rouge">app/controllers/boooks_controller.rb</code>).</p>
  </li>
  <li>
    <p>At the end of the <code class="highlighter-rouge">BooksController</code> add the <code class="highlighter-rouge">new</code> method.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="screenshot.jpg" alt="Browser showing ActionController::UnknownFormat error: &quot;BooksController#new is missing a template for this request format and variant.&quot;" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Another error, but it should also look familiar.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>BooksController#new is missing a template for this request format and variant.
</code></pre>
    </div>

    <p>You‚Äôve added the <code class="highlighter-rouge">new</code> method to the BooksController, but you haven‚Äôt created the <code class="highlighter-rouge">new</code> action‚Äôs template.</p>

    <p>Let‚Äôs add it!</p>
  </li>
  <li>
    <p>Go back to terminal and stop your application‚Äôs web server by running <code class="highlighter-rouge">Ctrl-C</code>.</p>
  </li>
  <li>
    <p>Now, run <code class="highlighter-rouge">touch app/views/books/new.html.erb</code> to create the <code class="highlighter-rouge">new</code> action‚Äôs template.</p>
  </li>
  <li>
    <p>Restart your application‚Äôs web server and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>. What do you see?</p>

    <p>A blank page! üéâ</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ rails server
  ...
  ^CExiting

  ‚Ä∫ touch app/views/books/new.html.erb

  ‚Ä∫ rails server
  <span class="o">=</span>&gt; Booting Puma
  <span class="o">=</span>&gt; Rails 5.0.0.1 application starting <span class="k">in </span>development on http://localhost:3000
  <span class="o">=</span>&gt; Run <span class="sb">`</span>rails server -h<span class="sb">`</span> <span class="k">for </span>more startup options</code></pre></figure>

</div>

<div class="aside">
<p>Data is usually added to web applications through forms.</p>

<p>You probably have never noticed them, but forms are everywhere on the internet. When you login to a site, you enter your credentials into a form. When you post a status on Facebook, you enter your status into a form. When you‚Äôre Googling for programming resources, you enter your search terms into a form.</p>

<p>After you add your data to a form, you submit it by clicking a submit button. For example, a login form might have a submit button that says ‚ÄúLogin‚Äù.</p>

<p>We‚Äôre going to use forms to create new books in your application.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In your text editor, open <code class="highlighter-rouge">app/views/books/new.html.erb</code> and add the following code:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= form_for(@book) do |f| %&gt;
&lt;% end %&gt;
</span></code></pre>
    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">form_for</code> is a method provided by Rails. It provides a consistent interface to build forms inside Rails applications.</p>

    <p>Here, we‚Äôre passing <code class="highlighter-rouge">@book</code> to <code class="highlighter-rouge">form_for</code> because we want to create a form for a book.</p>

    <p><code class="highlighter-rouge">form_for</code> takes a block as its last argument. We haven‚Äôt done anything interesting inside the block, but that‚Äôll change soon :)</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>  <span class="o">&lt;</span><span class="sx">%= form_for(@book) do |f| %&gt;
  &lt;% end %&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="screenshot.jpg" alt="Browser showing Argument Error in Books#new: &quot;First argument in form cannot contain nil or be empty&quot;" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Hmm‚Ä¶an error.</p>

    <p>You‚Äôre seeing an <code class="highlighter-rouge">ArgumentError</code> in <code class="highlighter-rouge">Books#new</code>.</p>

    <p>There‚Äôs a lot going on in the error, but the message has a helpful hint.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>First argument in form cannot contain nil or be empty
</code></pre>
    </div>

    <p>Remember the code we used to start the form?</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= form_for(@book) do |f| %&gt;
</span></code></pre>
    </div>

    <p><code class="highlighter-rouge">@book</code> is the first argument in the form, so the error is telling us <code class="highlighter-rouge">@book</code> must be nil or empty.</p>

    <p>How could <code class="highlighter-rouge">@book</code> be nil?</p>
  </li>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor and take a look at the <code class="highlighter-rouge">new</code> method.</p>

    <p>Is <code class="highlighter-rouge">@book</code> defined inside in the new method?</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
<span class="k">end</span>
</code></pre>
    </div>

    <p>It‚Äôs nowhere to be found! That explains that error üòÖ</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Let‚Äôs fix that error.</p>
  </li>
  <li>
    <p>Inside the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">new</code> method, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
</code></pre>
    </div>

    <p><code class="highlighter-rouge">@book</code> is set to be a new book because we want to create a form for new books.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>No errors! But we have a blank page. Let‚Äôs start building out that form.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In your text editor, open <code class="highlighter-rouge">app/views/books.new.html.erb</code>.</p>
  </li>
  <li>
    <p>Inside the <code class="highlighter-rouge">form_for</code> block, add the following:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= f.label :title %&gt;
    &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="o">%&gt;</span>
  <span class="o">&lt;</span><span class="sr">/li&gt;

  &lt;li&gt;
    &lt;%= f.label :author %&gt;
    &lt;%= f.text_field :author %&gt;
  &lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/ul&gt;
</span></code></pre>
    </div>

    <p>We‚Äôre putting your form elememnts inside an unordered list. The form will have two fields, one for title and one for author.</p>

    <p><code class="highlighter-rouge">f.label</code> defines labels for each field.</p>

    <p><code class="highlighter-rouge">f.text_field</code> creates a text input field for each field.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>Can you match the code you added to the different elements on the page?</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>Your <code class="highlighter-rouge">new</code> book form has fields for title and author, try adding a field for the price. Remember, we named the field <code class="highlighter-rouge">price_cents</code>.</li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>What did you come up with? If you followed the pattern used for the other two fields, you probably came up with something like this:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= f.label :price_cents %&gt;
  &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:price_cents</span> <span class="o">%&gt;</span>
<span class="o">&lt;</span><span class="sr">/li&gt;
</span></code></pre>
    </div>
  </li>
  <li>
    <p>That works well, but <code class="highlighter-rouge">price_cents</code> isn‚Äôt a text field. It‚Äôs a number.</p>
  </li>
  <li>
    <p>To make it a number field, simply change</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= f.text_field :price_cents %&gt;
</span></code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= f.number_field :price_cents %&gt;
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Your full solution should look like this:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= f.label :price_cents %&gt;
  &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="o">%&gt;</span>
<span class="o">&lt;</span><span class="sr">/li&gt;
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Update your solution, save your changes, and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>Does the <code class="highlighter-rouge">price_cents</code> field differ from other fields on the page?</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>  <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :title %&gt;
      &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="o">%&gt;</span>
    <span class="o">&lt;</span><span class="sr">/li&gt;

    &lt;li&gt;
      &lt;%= f.label :author %&gt;
      &lt;%= f.text_field :author %&gt;
    &lt;/</span><span class="n">li</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.label :price_cents %&gt;
      &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price_cents</span> <span class="o">%&gt;</span>
    <span class="o">&lt;</span><span class="sr">/li&gt;
  &lt;/u</span><span class="n">l</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>We have a couple more fields to add to the form. We need fields for quantity and description.</p>
  </li>
  <li>
    <p>Add <code class="highlighter-rouge">quantity</code> to your form as a <code class="highlighter-rouge">number_field</code>.</p>
  </li>
  <li>
    <p>Add <code class="highlighter-rouge">description</code> to your form as a <code class="highlighter-rouge">text_area</code>.</p>

    <p>(<code class="highlighter-rouge">text_area</code> differs from <code class="highlighter-rouge">text_field</code> by offering more space for text - which is useful for long descriptions.)</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>What does your solution look like? Your compelte form should look like this:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= form_for(@book) do |f| %&gt;
  &lt;ul&gt;
    &lt;li&gt;
      &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="o">%&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.text_field :title %&gt;
    &lt;/li&gt;

    &lt;li&gt;
      &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="o">%&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.text_field :author %&gt;
    &lt;/li&gt;

    &lt;li&gt;
      &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:price_cents</span> <span class="o">%&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.number_field :price_cents %&gt;
    &lt;/li&gt;

    &lt;li&gt;
      &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:quantity</span> <span class="o">%&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.number_field :quantity %&gt;
    &lt;/li&gt;

    &lt;li&gt;
      &lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:description</span> <span class="o">%&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= f.text_area :description %&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;% end %&gt;
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Update your solution to match this solution and save your changes.</p>
  </li>
</ol>
</div>
</div>

<p><img src="screenshot.jpg" alt="Browser showing &quot;/books/new&quot; with a form full of fields" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now you have a beautiful form full of fields. You can enter so much book data! üòç</p>

    <p>But there‚Äôs no way for you to save that data in your application‚Äôs database üòû</p>

    <p>Don‚Äôt worry! We can fix that!</p>
  </li>
  <li>
    <p>At the end of the <code class="highlighter-rouge">form_for</code> block`, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= f.submit %&gt;
</span></code></pre>
    </div>

    <p>This will add a submission button to your form.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p><code class="highlighter-rouge">f.submit</code> generates a button labeled ‚ÄúCreate Book‚Äù</p>
  </li>
</ol>
</div>
</div>

<p><img src="screenshot.jpg" alt="Browser showing &quot;/books/new&quot; with a form you can submit" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now that you have a form with a shinny ‚ÄúCreate Book‚Äù button, why don‚Äôt you try creating a book?</p>

    <p>Fill out the form and click ‚ÄúCreate Book‚Äù.</p>
  </li>
  <li>
    <p>Error? ERROR?!</p>

    <p><img src="http://33.media.tumblr.com/bb7001d20808a632321af9dbcb51ae58/tumblr_nc3gm08zeS1rmoy1jo4_1280.gif" alt="Anger!" title="We should serve this file locally" /></p>
  </li>
  <li>
    <p>You‚Äôre getting an <code class="highlighter-rouge">Unknown action</code> error that says ‚ÄúThe action ‚Äòcreate‚Äô could not be found for BooksController‚Äù.</p>

    <p>Huh?</p>

    <p>We‚Äôve been working with the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">new</code> action? How did we end up with an error for the <code class="highlighter-rouge">create</code> action?</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Take a look at what happened in your application‚Äôs web server when you clicked ‚ÄúCreate Book‚Äù.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>Started POST <span class="s2">"/books"</span> <span class="k">for</span> ::1 at 2016-12-27 14:32:50 -0500

AbstractController::ActionNotFound <span class="o">(</span>The action <span class="s1">'create'</span> could not be found <span class="k">for </span>BooksController<span class="o">)</span>:
</code></pre>
    </div>

    <p>Before the error happened, the server received a POST request to the <code class="highlighter-rouge">/books</code> path. This request happened when you clicked the ‚ÄúCreate Book‚Äù button.</p>

    <p>Your form‚Äôs data was submitted as a POST request to the <code class="highlighter-rouge">/books</code> path.</p>
  </li>
  <li>
    <p>Real interesting, right? Let‚Äôs take a look at your application routes again.</p>
  </li>
  <li>
    <p>Go back to Terminal and stop your application‚Äôs web server by running <code class="highlighter-rouge">Ctrl-C</code>. Then, run <code class="highlighter-rouge">rake routes</code>.</p>
  </li>
  <li>
    <p>Take a look at the second row of the routing table.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>POST   /books<span class="o">(</span>.:format<span class="o">)</span>          books#create
</code></pre>
    </div>

    <p>Does that look familiar? üòâ</p>

    <p>POST requests to <code class="highlighter-rouge">/books</code> get sent to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action!</p>
  </li>
  <li>
    <p>It looks like we were destined to reach the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action, but how did the form know to go there?</p>

    <p>By default, a <code class="highlighter-rouge">form_for</code> with a new record will be wired up to POST requests to its matching <code class="highlighter-rouge">create</code> action.</p>

    <p>In our case, we setup <code class="highlighter-rouge">form_for</code> with a new book. Therefore, the form was setup to POST to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action.</p>
  </li>
  <li>
    <p>Does this make sense to you?</p>

    <p>If it does, I‚Äôm impressed. I‚Äôm having a hard understanding it all üòÖ</p>
  </li>
  <li>
    <p>Don‚Äôt worry if you don‚Äôt understand everything that is going on. It will make more sense over time.</p>

    <p>The key take away here is the <code class="highlighter-rouge">new</code> book form gets submitted to the <code class="highlighter-rouge">BooksController</code> create action.</p>
  </li>
  <li>
    <p>Restart your application‚Äôs web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ rails server
  ...
  ^CExiting

  ‚Ä∫ rake routes
     Prefix Verb   URI Pattern               Controller#Action
      books GET    /books<span class="o">(</span>.:format<span class="o">)</span>          books#index
            POST   /books<span class="o">(</span>.:format<span class="o">)</span>          books#create
   new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>      books#new
  edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span> books#edit
       book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#show
            PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#update
            DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>      books#destroy

  ‚Ä∫ rails server</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor.</p>
  </li>
  <li>
    <p>Add a <code class="highlighter-rouge">create</code> method to the end of the controller.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes and try adding a book again.</p>

    <p>Nothing happens! Hey, it‚Äôs better than an error‚Ä¶</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>The <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action is going to be responsible for using your form data to create a new book.</p>
  </li>
  <li>
    <p>Take a look at the request parameters that are sent when you submit the new book form.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>Started POST <span class="s2">"/books"</span> <span class="k">for</span> ::1 at 2016-12-27 15:29:52 -0500
Processing by BooksController#create as HTML
  Parameters: <span class="o">{</span><span class="s2">"utf8"</span><span class="o">=</span>&gt;<span class="s2">"‚úì"</span>, <span class="s2">"authenticity_token"</span><span class="o">=</span>&gt;<span class="s2">"AOZpk66Fc20R/9xHVhxZLiSwsQj29isG2ohi9gS6TKXT0PUP3n9hYJQrPpY8iSx6uessf9Sgsd3Uv3rEuB/TvQ=="</span>, <span class="s2">"book"</span><span class="o">=</span>&gt;<span class="o">{</span><span class="s2">"title"</span><span class="o">=</span>&gt;<span class="s2">"The Cat in the Hat"</span>, <span class="s2">"author"</span><span class="o">=</span>&gt;<span class="s2">"Dr. Seuss"</span>, <span class="s2">"price_cents"</span><span class="o">=</span>&gt;<span class="s2">"500"</span>, <span class="s2">"quantity"</span><span class="o">=</span>&gt;<span class="s2">"1000"</span>, <span class="s2">"description"</span><span class="o">=</span>&gt;<span class="s2">"That crazy cat!"</span><span class="o">}</span>, <span class="s2">"commit"</span><span class="o">=</span>&gt;<span class="s2">"Create Book"</span><span class="o">}</span>
</code></pre>
    </div>

    <p>Inside the parameters hash, there‚Äôs a ‚Äúbook‚Äù key with its own hash.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="s2">"book"</span><span class="o">=</span>&gt;<span class="o">{</span><span class="s2">"title"</span><span class="o">=</span>&gt;<span class="s2">"The Cat in the Hat"</span>, <span class="s2">"author"</span><span class="o">=</span>&gt;<span class="s2">"Dr. Seuss"</span>, <span class="s2">"price_cents"</span><span class="o">=</span>&gt;<span class="s2">"500"</span>, <span class="s2">"quantity"</span><span class="o">=</span>&gt;<span class="s2">"1000"</span>, <span class="s2">"description"</span><span class="o">=</span>&gt;<span class="s2">"That crazy cat!"</span><span class="o">}</span>
</code></pre>
    </div>

    <p>This is the server output for the book <em>I</em> was trying to add, but your server output should look similar.</p>

    <p>(Unless you were trying add <em>The Cat in the Hat</em>. Then, it should look pretty much the same‚Ä¶)</p>

    <p>To get the book data that‚Äôs POSTed to the server, we need to access the <code class="highlighter-rouge">book</code> key in the <code class="highlighter-rouge">params</code> hash.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Add the following code to your <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
</code></pre>
    </div>

    <p>We‚Äôre using <code class="highlighter-rouge">Book.create</code> to create a new book. The new book‚Äôs attributes are being set with values from the <code class="highlighter-rouge">params</code> hash <code class="highlighter-rouge">book</code> key.</p>
  </li>
  <li>
    <p>Save you changes and try adding a book again.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Nothing happened, right?</p>

    <p>Not exactly‚Ä¶</p>
  </li>
  <li>
    <p>Go to Terminal and stop your application‚Äôs web server.</p>
  </li>
  <li>
    <p>Now, run <code class="highlighter-rouge">rails console</code> and get the last book in your database.</p>

    <p>Does it look familiar?</p>

    <p>It‚Äôs the book you created!</p>
  </li>
  <li>
    <p>Although it looked like nothing happened when you clicked submit, the request made it to the <code class="highlighter-rouge">BooksController</code> <code class="highlighter-rouge">create</code> action and <code class="highlighter-rouge">Book.create</code> was run.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">create</code> action is almost done. Now, we just need make the experience a little better.</p>
  </li>
  <li>
    <p>Exit <code class="highlighter-rouge">rails console</code> and restart your application‚Äôs web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="err">‚Ä∫</span> <span class="n">rails</span> <span class="n">server</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">^</span><span class="no">CExiting</span>

  <span class="err">‚Ä∫</span> <span class="n">rails</span> <span class="n">console</span>
  <span class="no">Loading</span> <span class="n">development</span> <span class="n">environment</span> <span class="p">(</span><span class="no">Rails</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
  <span class="o">&gt;&gt;</span> <span class="no">Book</span><span class="p">.</span><span class="nf">last</span>
    <span class="no">Book</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="s2">"books"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"books"</span> <span class="no">ORDER</span> <span class="no">BY</span> <span class="s2">"books"</span><span class="o">.</span><span class="s2">"id"</span> <span class="no">DESC</span> <span class="no">LIMIT</span> <span class="p">?</span>  <span class="p">[[</span><span class="s2">"LIMIT"</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
  <span class="o">=&gt;</span> <span class="c1">#&lt;Book id: 8, title: "The Cat in the Hat", author: "Dr. Seuss", price_cents: 500, created_at: "2016-12-27 20:46:15", updated_at: "2016-12-27 20:46:15", quantity: 1000, description: "That crazy cat!"&gt;</span>

  <span class="o">&gt;&gt;</span> <span class="nb">exit</span>

  <span class="err">‚Ä∫</span> <span class="n">rails</span> <span class="n">server</span></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>In your text editor, open the <code class="highlighter-rouge">BooksController</code>.</p>
  </li>
  <li>
    <p>At the end of the <code class="highlighter-rouge">create</code> method, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">redirect_to</span> <span class="n">books_path</span>
</code></pre>
    </div>

    <p>With this change, you‚Äôll be redirected to the <code class="highlighter-rouge">books_path</code> after a new book is created.</p>

    <p><code class="highlighter-rouge">books_path</code> is a Rails helper method. It evaluates to <code class="highlighter-rouge">/books</code> or your book index page.</p>
  </li>
  <li>
    <p>Save your changes and revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>Add a new book and you will be redirected to the books index. The new book will show up at the end of the index.</p>

    <p><em>Magic</em></p>

    <p><img src="https://www.drupal.org/files/shia-magic.gif" alt="Magic" title="We should serve this image locally" /></p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Ah, it feels like we‚Äôve come so far from those days of creating books on the console‚Ä¶</p>

    <p>What? It hasn‚Äôt been that long?</p>

    <p>Anyways‚Ä¶</p>

    <p>Things are coming together nicely. Let‚Äôs take a look at cleaning some stuff up. First, we‚Äôll start with the <code class="highlighter-rouge">BooksController</code>.</p>
  </li>
  <li>
    <p>Open the <code class="highlighter-rouge">BooksController</code> in your text editor and take a look at the <code class="highlighter-rouge">create</code> method.</p>
  </li>
  <li>
    <p>In the first line of the <code class="highlighter-rouge">create</code> method, you‚Äôre calling <code class="highlighter-rouge">Book.create</code> and setting attributes one by one from the params hash.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
</code></pre>
    </div>

    <p>Do you notice a pattern in the attributes that are being set?</p>

    <p>Every attribute that you‚Äôre setting is in <code class="highlighter-rouge">params[:book]</code>.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">]</span>
<span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">]</span>
<span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">]</span>
<span class="p">.</span><span class="nf">.</span><span class="o">.</span>
</code></pre>
    </div>

    <p>Since every attribute you‚Äôre setting is in <code class="highlighter-rouge">params[:book]</code>, we can simplify that line.</p>
  </li>
  <li>
    <p>Change <code class="highlighter-rouge">Book.create</code> from</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">title: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:title</span><span class="p">],</span> <span class="ss">author: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:author</span><span class="p">],</span> <span class="ss">price_cents: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:price_cents</span><span class="p">],</span> <span class="ss">quantity: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:quantity</span><span class="p">],</span> <span class="ss">description: </span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">][</span><span class="ss">:description</span><span class="p">])</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">])</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>, and try creating a book.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">])</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="screenshot.jpg" alt="Browser showing ActiveModel::ForbiddenAttributesError in BooksController#create" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>So‚Ä¶that didn‚Äôt work.</p>

    <p>The change we made is valid, but we‚Äôre running into a Rails security feature.</p>
  </li>
  <li>
    <p>Rails won‚Äôt let you set several attributes at once with data from a request. In this case, the data came from a request you generated. However, it‚Äôs not hard to imagine a malicious user sending harmful data.</p>

    <p>Before you can set several attributes at once from request data, you have to explicitly state which attributes can be set. That‚Äôs why you‚Äôre seeing an <code class="highlighter-rouge">ActiveModel::ForbiddenAttributesError</code> - you haven‚Äôt permitted any attributes.</p>

    <p>This security feature is called <a href="http://guides.rubyonrails.org/action_controller_overview.html#strong-parameters">strong parameters</a>.</p>
  </li>
  <li>
    <p>To use strong parameters, change <code class="highlighter-rouge">Book.create</code> from</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:book</span><span class="p">])</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">)</span>
</code></pre>
    </div>

    <p>When we want to create a book from the <code class="highlighter-rouge">params</code> hash, the <code class="highlighter-rouge">params</code> hash must have a <code class="highlighter-rouge">book</code> hash. From the <code class="highlighter-rouge">book</code> hash, we‚Äôll get any of the permitted attributes and assign them to the new book.</p>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>, and try creating a book again.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">all</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">show</span>
      <span class="vi">@id</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="vi">@id</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">new</span>
      <span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="no">Book</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:book</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:price_cents</span><span class="p">,</span> <span class="ss">:quantity</span><span class="p">,</span> <span class="ss">:description</span><span class="p">))</span>
      <span class="n">redirect_to</span> <span class="n">books_path</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>To create books in the browser, you‚Äôve been going directly to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>. That works, but it isn‚Äôt very convenient.</p>

    <p>Let‚Äôs add a link to the book index that will take us to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>
  </li>
  <li>
    <p>Open <code class="highlighter-rouge">app/view/books/index.html.erb</code> in your text editor.</p>
  </li>
  <li>
    <p>After the unordered list, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="sx">%= link_to("Add a book", new_book_path) %&gt;
</span></code></pre>
    </div>

    <p>We‚Äôre using the <code class="highlighter-rouge">link_to</code> helper to create a link. The link‚Äôs text will be ‚ÄúAdd a book‚Äù, and it will link to the new_book_path (<code class="highlighter-rouge">/books/new</code>).</p>
  </li>
  <li>
    <p>Save your changes and go to <a href="http://localhost:3000/books/new">http://localhost:3000/books/new</a>.</p>

    <p>You should see the new link. Clicking it should take you to the new book form.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>  <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="no">Welcome</span> <span class="n">to</span> <span class="no">My</span> <span class="no">Super</span> <span class="no">Rad</span> <span class="no">Bookstore</span><span class="o">!&lt;</span><span class="sr">/h1&gt;

  &lt;ul&gt;
    &lt;% @books.each do |book| %&gt;
      &lt;li&gt;
        &lt;%= link_to(book.title, book_path(book)) %&gt; by &lt;%= book.author %&gt;
      &lt;/</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
  <span class="o">&lt;</span><span class="sr">/ul&gt;

  &lt;%= link_to("Add a book", new_book_path) %&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="screenshot.jpg" alt="Browser showing book index with link to &quot;Add a book&quot;" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now you can add all the books you heart desires from the comfort of your browser.</p>
  </li>
  <li>
    <p>When you‚Äôre done adding books and basking in the glory, stop your application‚Äôs web server and give yourself a high five.</p>

    <p><img src="http://gifrific.com/wp-content/uploads/2012/04/Tina-Fey-giving-herself-high-five.gif" alt="Liz Lemon with the self high five" title="We should serve this file locally" /></p>
  </li>
</ol>
</div>
</div>

    </div>
  </div>
<footer>
  <div class="container">
    <p class="center-text">Here's the footer!!</a></p>
  </div>
</footer>
</body>
</html>

