<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
      <base target="_blank"/>
    
    <title>B'more on Rails Workshop for Women</title>
    <link href="/rails_tutorial/css/syntax/monokai.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/css/base.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/assets/vendor/css/featherlight.min.css" type="text/css" rel="stylesheet">
    <script src="/rails_tutorial/js/jquery.min.js"></script>
    <script src="/rails_tutorial/assets/vendor/js/featherlight.min.js"></script>
    <script src="/rails_tutorial/js/tutorial_nav.js"></script>
    <script src="/rails_tutorial/js/progress.js"></script>
  </head>

<body>
  <div class="container" data-chapter="13">
    <nav>
      
<div class="tutorial_nav">
  <div class="progress"><div class="progress_bar"></div></div>
  <ul id="menu-list">
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_01/" target="_self">
        1 Getting Started from Scratch
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_02/" target="_self">
        2 Creating the First Table in Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_03/" target="_self">
        3 Viewing Data in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_04/" target="_self">
        4 Showing Detailed Information in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_05/" target="_self">
        5 Creating Books Through the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_06/" target="_self">
        6 Updating Books
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_07/" target="_self">
        7 Styling Your Bookstore
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_08/" target="_self">
        8 Deleting a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_09/" target="_self">
        9 Reviewing a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_10/" target="_self">
        10 Showing Reviews
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_11/" target="_self">
        11 Adding Reviews from the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_12/" target="_self">
        12 Adding Users to Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_13/" target="_self">
        13 Logging In and Logging Out
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_14/" target="_self">
        14 Logged In vs Logged Out Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_15/" target="_self">
        15 Associating Reviews with Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_16/" target="_self">
        16 The End!
       </a>
     </li>
    
   </ul>

  <div class="menu">
    <div class="hamburger-icon" data-toggle="#menu-list"> &#9776</div>
    <div class="menu-title" data-toggle="#menu-list">Chapter 13 -- Logging In and Logging Out</div>
    <div class="menu-title"><a href="/rails_tutorial/" target="_self">Home</a></div>
  </div>
</div>

    </nav>
    <div class="content">
      <div class="sectionheader">
<p>Logging In and Logging Out</p>
</div>

<div class="aside">
<p>Your bookstore has users, but there‚Äôs no way for them to login. Let‚Äôs change that üòä</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Let‚Äôs start by looking at your application‚Äôs routes file. Open <code class="highlighter-rouge">config/routes.rb</code> in your text editor.</p>

    <p>You‚Äôve added a couple of resources to the routes file. First, you defined <code class="highlighter-rouge">:books</code>. This added a series of routes to your application for creating, reading, updating, and deleting your books. Then, you added another resource <code class="highlighter-rouge">:reviews</code>. This added similar routes, but they‚Äôre focused on reviews instead of books.</p>

    <p>Now that your application has users, it might be tempting to add a <code class="highlighter-rouge">:users</code> resource. This would be useful if we were going to change user data, but we don‚Äôt need to change any user data to log someone in.</p>

    <p>We just need to keep track of a user once they‚Äôve logged in to your bookstore. We‚Äôll represent this as a session - a user creates a new session when they log in.</p>
  </li>
  <li>
    <p>Let‚Äôs add a <code class="highlighter-rouge">:session</code> resource to your routes file. Before the end of <code class="highlighter-rouge">config/routes.rb</code>, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">resource</span> <span class="ss">:session</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre>  <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
    <span class="c1"># For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html</span>
    <span class="n">root</span> <span class="s2">"books#index"</span>

    <span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="ss">:reviews</span>
    <span class="k">end</span>

    <span class="n">resource</span> <span class="ss">:session</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Let‚Äôs see what your application routes look like now.</p>

<ol>
  <li>
    <p>Open Terminal, go the <code class="highlighter-rouge">bookstore</code> directory, and run <code class="highlighter-rouge">rake routes</code>.</p>

    <p>Aww, your routes are getting so big üòç</p>

    <p>When a user logs in, they‚Äôre going to create a new session. What path will they visit to create a new session?</p>

    <p>They‚Äôll go to <code class="highlighter-rouge">/session/new</code>.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>new_session GET    /session/new<span class="o">(</span>.:format<span class="o">)</span>                     sessions#new
</code></pre>
    </div>
  </li>
  <li>
    <p>Start your application‚Äôs web server and visit the new session path at <a href="http://localhost:3000/session/new">http://localhost:3000/session/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  ‚Ä∫ <span class="nb">pwd</span>
  /Users/awesomesauce/Projects/bookstore

  ‚Ä∫ rake routes
            Prefix Verb   URI Pattern                                Controller#Action
              root GET    /                                          books#index
      book_reviews GET    /books/:book_id/reviews<span class="o">(</span>.:format<span class="o">)</span>          reviews#index
                   POST   /books/:book_id/reviews<span class="o">(</span>.:format<span class="o">)</span>          reviews#create
   new_book_review GET    /books/:book_id/reviews/new<span class="o">(</span>.:format<span class="o">)</span>      reviews#new
  edit_book_review GET    /books/:book_id/reviews/:id/edit<span class="o">(</span>.:format<span class="o">)</span> reviews#edit
       book_review GET    /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#show
                   PATCH  /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#update
                   PUT    /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#update
                   DELETE /books/:book_id/reviews/:id<span class="o">(</span>.:format<span class="o">)</span>      reviews#destroy
             books GET    /books<span class="o">(</span>.:format<span class="o">)</span>                           books#index
                   POST   /books<span class="o">(</span>.:format<span class="o">)</span>                           books#create
          new_book GET    /books/new<span class="o">(</span>.:format<span class="o">)</span>                       books#new
         edit_book GET    /books/:id/edit<span class="o">(</span>.:format<span class="o">)</span>                  books#edit
              book GET    /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#show
                   PATCH  /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#update
                   PUT    /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#update
                   DELETE /books/:id<span class="o">(</span>.:format<span class="o">)</span>                       books#destroy
           session POST   /session<span class="o">(</span>.:format<span class="o">)</span>                         sessions#create
       new_session GET    /session/new<span class="o">(</span>.:format<span class="o">)</span>                     sessions#new
      edit_session GET    /session/edit<span class="o">(</span>.:format<span class="o">)</span>                    sessions#edit
                   GET    /session<span class="o">(</span>.:format<span class="o">)</span>                         sessions#show
                   PATCH  /session<span class="o">(</span>.:format<span class="o">)</span>                         sessions#update
                   PUT    /session<span class="o">(</span>.:format<span class="o">)</span>                         sessions#update
                   DELETE /session<span class="o">(</span>.:format<span class="o">)</span>                         sessions#destroy

  ‚Ä∫ rails server
  <span class="o">=</span>&gt; Booting Puma
  <span class="o">=</span>&gt; Rails 5.0.0.1 application starting <span class="k">in </span>development on http://localhost:3000</code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/uninitialized_constant_sessions.png" alt="Browser showing Routing Error: &quot;uninitialized constant SessionsController&quot;" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>Oh boy, another <code class="highlighter-rouge">Routing Error</code>! üòù</p>

<ol>
  <li>
    <p>The error tells you what‚Äôs wrong‚Ä¶</p>

    <div class="language-text highlighter-rouge"><pre class="highlight"><code>uninitialized constant SessionsController
</code></pre>
    </div>
  </li>
  <li>
    <p>Fix this familiar error and come back when you get a different one.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<p>Were you able to get past the <code class="highlighter-rouge">Routing Error</code>?</p>

<p>No worries if you‚Äôre stuck, we‚Äôll help you out üòä</p>

<ol>
  <li>
    <p>You‚Äôre getting a <code class="highlighter-rouge">Routing Error</code> because you application doesn‚Äôt have a <code class="highlighter-rouge">SessionsController</code>.</p>

    <p>To fix this, you need to create a <code class="highlighter-rouge">SessionsController</code>.</p>

    <p>All controllers follow a similar pattern. They live inside the <code class="highlighter-rouge">app/controllers</code> directory, and they‚Äôre filename matches their name.</p>

    <p>For example, the <code class="highlighter-rouge">SessionsController</code> will be a file named <code class="highlighter-rouge">app/controllers/sessions_controller</code>.</p>

    <p>Controllers also share the same roots. Do you remember what your <code class="highlighter-rouge">BooksController</code> looked like when you first added it?</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BooksControllers</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="k">end</span>
</code></pre>
    </div>

    <p>There wasn‚Äôt much to it, remember?</p>
  </li>
  <li>
    <p>If you didn‚Äôt create an empty <code class="highlighter-rouge">SessionsController</code> (<code class="highlighter-rouge">app/controllers/sessions_controller</code>), go ahead and create now.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Then, revisit <a href="http://localhost:3000/session/new">http://localhost:3000/session/new</a> to see your next error!</p>
  </li>
</ol>
</div>
</div>

<p><img src="/rails_tutorial/assets/images/session_unknown_new_action.png" alt="Browser showing Unknown action error: &quot;The action 'new' could not be found for SessionsController&quot;" class="screenshot" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Now, you‚Äôre getting an <code class="highlighter-rouge">Unknown action</code> error. Just like the last error, it‚Äôs giving you a hint.</p>

    <div class="language-text highlighter-rouge"><pre class="highlight"><code>The action 'new' could not be found for SessionsController
</code></pre>
    </div>

    <p>You know what to do, right?!</p>

    <p><img src="/rails_tutorial/assets/images/yup.gif" alt="...YES" /></p>
  </li>
  <li>
    <p>Fix that error. When you‚Äôre done, you‚Äôll get <em>one more error</em>.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>What did you come up with?! Are you seeing a new error??</p>

    <p>You had to add a <code class="highlighter-rouge">new</code> method to the <code class="highlighter-rouge">SessionsController</code>.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>If you didn‚Äôt already add the <code class="highlighter-rouge">new</code> method, go ahead and add it now.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/missing_template_sessions_new.png" alt="Browser showing ActionController::UnknownFormat error: &quot;SessionsController#new is missing a template for this request format and variant.&quot;" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>We‚Äôre <em>sooooo</em> close to the end of the error train.</p>

<p>Can you think of reason why you‚Äôre getting an <code class="highlighter-rouge">ActionController::UnknownFormat</code> error? It looks crazy, but we‚Äôve seen this plenty of times before.</p>

<p>You‚Äôre getting an <code class="highlighter-rouge">ActionController::UnknownFormat</code> error because the <code class="highlighter-rouge">SessionsController</code> <code class="highlighter-rouge">new</code> action doesn‚Äôt have a template.</p>

<ol>
  <li>
    <p>Fix this error!</p>

    <p>Remember, templates for the <code class="highlighter-rouge">SessionsController</code> will live inside <code class="highlighter-rouge">app/views/sessions</code>.</p>

    <p>When you‚Äôre done, <a href="http://localhost:3000/session/new">http://localhost:3000/session/new</a> will render a blank page.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Did you figure out how to add the <code class="highlighter-rouge">SessionsController</code> <code class="highlighter-rouge">new</code> template?</p>

    <p>You had to add a new directory.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>mkdir app/views/sessions
</code></pre>
    </div>

    <p>Then, you had to create an empty template file named <code class="highlighter-rouge">new.html.erb</code> inside <code class="highlighter-rouge">app/views/sessions</code>.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>touch app/views/sessions/new.html.erb
</code></pre>
    </div>
  </li>
  <li>
    <p>If you didn‚Äôt already, add the empty <code class="highlighter-rouge">SessionsController</code> <code class="highlighter-rouge">new</code> template file (<code class="highlighter-rouge">app/views/sessions/new.html.erb</code>).</p>

    <p>If you‚Äôre following the steps we just laid out, you‚Äôll have to stop your application‚Äôs web server before running the commands. When you‚Äôre done, you can restart it.</p>

    <p>Ah, has a blank page ever looked so good?</p>
  </li>
</ol>
</div>
</div>

<div class="aside">
<p>A blank page is great and all, but wouldn‚Äôt it be even better if a user could log in?!</p>

<p>In the <code class="highlighter-rouge">SessionsController</code> <code class="highlighter-rouge">new</code> template, we need to render a form where users can enter their credentials to create a new session and log in.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/views/sessions/new.html.erb</code> and add the following:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="ss">:session</span><span class="p">,</span> <span class="ss">url: </span><span class="n">session_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>The <code class="highlighter-rouge">form_for</code> might look a little familiar. We‚Äôve used it to build forms for adding and updating books, and adding new reviews. However, there are a few differences.</p>

    <p>In the past forms you‚Äôve built with <code class="highlighter-rouge">form_for</code>, you started by passing an instance of the record you wanted to update or create. For example, the new books form has a new instance of <code class="highlighter-rouge">Book</code>.</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@book</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>We aren‚Äôt doing this for the new session form because we‚Äôre not going to save the session in the database. We‚Äôre going to save it in the browser (more on that later).</p>

    <p>Unlike the other forms, we have to specify a URL for the new session form. <code class="highlighter-rouge">form_for</code> can figure out where to send the form data when given an instance of a class; otherwise, you have to expcitily set the URL.</p>

    <p>Other than that, the new session form is just like the other forms you‚Äôve built.</p>
  </li>
  <li>
    <p>Using the new book form in <code class="highlighter-rouge">app/views/books/new.html.erb</code> as an example, add two text fields to the new sessions form.</p>

    <p>First, add a text field labeled ‚ÄúUsername‚Äù.</p>

    <p>Then, add a text field labeled ‚ÄúPassword‚Äù.</p>

    <p>Finally, add a form submission button.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="ss">:session</span><span class="p">,</span> <span class="ss">url: </span><span class="n">session_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>What does your solution look like? It should look something like this:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="ss">:session</span><span class="p">,</span> <span class="ss">url: </span><span class="n">session_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:username</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:username</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>

    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Update your soultion to match this solution. Save your changes and take a look at the form by visiting <a href="http://localhost:3000/session/new">http://localhost:3000/session/new</a>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="ss">:session</span><span class="p">,</span> <span class="ss">url: </span><span class="n">session_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:username</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:username</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/new_session_form.png" alt="Browser showing new session form" class="screenshot" /></p>

<div class="aside">
<p>Yay! The form looks so good!!</p>

<p>But you might‚Äôve noticed a couple of‚Ä¶weird things.</p>

<p>First, did you try typing anything in the ‚ÄúPassword‚Äù field. It shows up as plain text! That‚Äôs not great if we‚Äôre trying to protect passwords. Fortunately, we can change this behavior.</p>

<p>Also, the form submission button doesn‚Äôt have the friendliest message. ‚ÄúSave Session‚Äù is <em>technically</em> right, but most users probably expect to see something like ‚ÄúLogin‚Äù.</p>

<p>Let‚Äôs make these things better!</p>

<p><img src="/rails_tutorial/assets/images/spongebobcantwait.gif" alt="Spongebob can't wait!" /></p>
</div>

<div class="steps">
<div class="list">
<p>First, we can change the ‚ÄúPassword‚Äù field from a text field to a password field.</p>

<ol>
  <li>
    <p>Reopen <code class="highlighter-rouge">app/views/sessions/new.html.erb</code> and change</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">password_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Now, let‚Äôs change the text of the form submission button to ‚ÄúLogin‚Äù. Change</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="s2">"Login"</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"button"</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/session/new">http://localhost:3000/session/new</a>, and try logging in!</p>

    <p>You should have a user with username ‚ÄúCatPower‚Äù and a password of ‚Äúpassword‚Äù.</p>
  </li>
</ol>
</div>
</div>

<p><img src="/rails_tutorial/assets/images/unknown_create_session.png" alt="Browser showing Unknown action error: &quot;The action 'create' could not be found for SessionsController&quot;" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>‚Ä¶</p>

<p><img src="/rails_tutorial/assets/images/cowboys.jpg" alt="Why'd it have to be errors?" /></p>

<p>You know how to deal with <code class="highlighter-rouge">Unknown action</code> errors, right?!</p>

<p><img src="/rails_tutorial/assets/images/genewilder.gif" alt="Of course" /></p>

<ol>
  <li>
    <p>Fix this error!</p>

    <p>When you‚Äôre done, submitting the form shouldn‚Äôt do anything.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>How did you get past that <code class="highlighter-rouge">Unknown action</code> error?</p>

    <p>You added an empty <code class="highlighter-rouge">create</code> method to the <code class="highlighter-rouge">SessionsController</code>, right?</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>If you didn‚Äôt already, add an empty <code class="highlighter-rouge">create</code> method to the <code class="highlighter-rouge">SessionsController</code>.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Nothing happens when you try to login, but how <em>could</em> anything happen. The new session form is being submitted to the <code class="highlighter-rouge">SessionsController</code> <code class="highlighter-rouge">create</code> method, and that method is empty.</p>

<p>Let‚Äôs update the <code class="highlighter-rouge">create</code> method so users can login.</p>

<ol>
  <li>
    <p>Just like past forms, the new session form data is available in the <code class="highlighter-rouge">SessionsController</code> inside the <code class="highlighter-rouge">params</code> hash. If you take a look at your application‚Äôs web server‚Äôs output, you can see the params coming in.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>Parameters: <span class="o">{</span><span class="s2">"utf8"</span><span class="o">=</span>&gt;<span class="s2">"‚úì"</span>, <span class="s2">"authenticity_token"</span><span class="o">=</span>&gt;<span class="s2">"C2s/BLrDEpUMmOL+FMx6SqNzLTqKvcLlvpw32+lD2O32Aryi9Kt0tlWVM+gUS3DYhQt1+3q0Tn3kqakWdZylVw=="</span>, <span class="s2">"session"</span><span class="o">=</span>&gt;<span class="o">{</span><span class="s2">"username"</span><span class="o">=</span>&gt;<span class="s2">"CatPower"</span>, <span class="s2">"password"</span><span class="o">=</span>&gt;<span class="s2">"[FILTERED]"</span><span class="o">}</span>, <span class="s2">"commit"</span><span class="o">=</span>&gt;<span class="s2">"Login"</span><span class="o">}</span>
</code></pre>
    </div>

    <p>The form data is tucked in the <code class="highlighter-rouge">session</code> hash, and it includes a username and password.</p>

    <p>We can use the form data with the <code class="highlighter-rouge">authenticate</code> method to log users in.</p>
  </li>
  <li>
    <p>First, we‚Äôll need to find the user by their username. Add the following code inside the <code class="highlighter-rouge">create</code> method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">username: </span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:username</span><span class="p">])</span>
</code></pre>
    </div>

    <p><code class="highlighter-rouge">find_by</code> is a handy method that let‚Äôs us get records from your database with something other than an id. We‚Äôre using <code class="highlighter-rouge">find_by</code> here to get the user by their username.</p>
  </li>
  <li>
    <p>Now that we have the user‚Äôs record, we can check if they‚Äôve given us a valid password. Add the following code to the <code class="highlighter-rouge">create</code> mehtod:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
  <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Welcome back, </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">username</span><span class="si">}</span><span class="s2">!"</span>
  <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
  <span class="n">redirect_to</span> <span class="n">root_path</span>
<span class="k">else</span>
  <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Sorry, your username or password is invalid."</span>
  <span class="n">render</span> <span class="ss">:new</span>
<span class="k">end</span>
</code></pre>
    </div>

    <p>First, we‚Äôll try to <code class="highlighter-rouge">authenticate</code> the user. If the user is successfully authenticated, we‚Äôll</p>

    <ul>
      <li>show them a success message</li>
      <li>save their id in the browser‚Äôs session as <code class="highlighter-rouge">user_id</code></li>
      <li>send them to the <code class="highlighter-rouge">root_path</code></li>
    </ul>

    <p>If the user cannot be authenticated, we‚Äôll</p>

    <ul>
      <li>show them a failure message</li>
      <li>re-render the <code class="highlighter-rouge">new</code> template so they can try logging in again</li>
    </ul>
  </li>
  <li>
    <p>There‚Äôs a lot happening here, so let‚Äôs try to break it down to get a better feel for what each of these lines of code is doing.</p>

    <p>Before we continue, save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">username: </span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:username</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
        <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Welcome back, </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">username</span><span class="si">}</span><span class="s2">!"</span>
        <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
        <span class="n">redirect_to</span> <span class="n">root_path</span>
      <span class="k">else</span>
        <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Sorry, your username or password is invalid."</span>
        <span class="n">render</span> <span class="ss">:new</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<h3 id="the-rails-session">The Rails Session</h3>

<p>Let‚Äôs start by looking at this line:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
</code></pre>
</div>

<p>Rails saves a session for every user that visits your application. By default, these sessions are stored in the user‚Äôs browser using something called <a href="https://en.wikipedia.org/wiki/HTTP_cookie">cookies</a>. Cookies are small files that browsers can use to save data on a user‚Äôs machine.</p>

<p>To protect the session‚Äôs contents, Rails signs and encrypts it so the contents are only accessible by the Rails application.</p>

<p>Rails makes the session available as a <code class="highlighter-rouge">session</code> hash. You can save anything inside the <code class="highlighter-rouge">session</code> hash. For example, we decided to store a <code class="highlighter-rouge">user_id</code>.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
</code></pre>
</div>

<p>Sessions are probably feeling really abstract right now, but they‚Äôll make more sense when you see them in action.</p>
</div>

<div class="aside">
<h3 id="flash-messages">Flash Messages</h3>

<p>In the <code class="highlighter-rouge">create</code> method, we also made use of the flash.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Welcome back, </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">username</span><span class="si">}</span><span class="s2">!"</span>
</code></pre>
</div>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Sorry, your username or password is invalid."</span>
</code></pre>
</div>

<p>The flash is also part of the session, but it doesn‚Äôt get saved in the user‚Äôs browser. Instead, the flash is cleared after every request.</p>

<p>We can take advantage of the flash‚Äôs short life cycle to temporarily show messages. For example, imagine what happens after you a user logs in to your bookstore. It‚Äôs nice to see the welcome back message, but you don‚Äôt really need continue seeing that message as you make your rounds through the bookstore.</p>

<p>Just like the session, the flash is made available in your application as a <code class="highlighter-rouge">flash</code> hash. You can also store anything in the flash, but it‚Äôs commonly used to save things like <code class="highlighter-rouge">notice</code>s and <code class="highlighter-rouge">alert</code>s.</p>

<p>In the <code class="highlighter-rouge">create</code> method, you‚Äôre putting the succes message in <code class="highlighter-rouge">flash[:notice]</code> and the failure message is <code class="highlighter-rouge">flash[:alert]</code>. To show these messages, we need to make a change to your application‚Äôs layout template.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/views/layouts/application.html.erb</code>.</p>
  </li>
  <li>
    <p>Before the <code class="highlighter-rouge">container</code> <code class="highlighter-rouge">div</code>, add the following lines:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"notice"</span><span class="nt">&gt;</span> <span class="cp">&lt;%=</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"alert"</span><span class="nt">&gt;</span> <span class="cp">&lt;%=</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
    </div>

    <p>If anything is inside <code class="highlighter-rouge">flash[:notice]</code> or <code class="highlighter-rouge">flash[:alert]</code>, we‚Äôll render their contents.</p>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre>  <span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;title&gt;</span>Bookstore<span class="nt">&lt;/title&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media: </span><span class="s1">'all'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navigation"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"My Super Rad Bookstore"</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"notice"</span><span class="nt">&gt;</span> <span class="cp">&lt;%=</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/p&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="o">%</span>
        <span class="o">&lt;</span><span class="nb">p</span> <span class="k">class</span><span class="o">=</span><span class="s2">"alert"</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="sx">%= flash[:alert] </span><span class="cp">%&gt;</span> <span class="nt">&lt;/p&gt;</span>
      <span class="cp">&lt;%</span><span class="sx"> end </span><span class="cp">%&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span><span class="sx"> yield </span><span class="cp">%&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Now that you have a fully functional <code class="highlighter-rouge">create</code> method, let‚Äôs take it out for a spin!</p>

<p><img src="/rails_tutorial/assets/images/Flyingcar.gif" alt="Car flying away" /></p>

<ol>
  <li>
    <p>Go to <a href="http://localhost:3000/session/new">http://localhost:3000/session/new</a> and try logging in with an invalid username.</p>

    <p>‚Ä¶</p>

    <p><img src="/rails_tutorial/assets/images/ugh.gif" alt="Not again" /></p>
  </li>
</ol>
</div>
</div>

<p><img src="/rails_tutorial/assets/images/invalid_user_name_error.png" alt="Browser showing NoMethodError: &quot;undefined method `authenticate' for nil:NilClass&quot;" class="screenshot" /></p>

<div class="aside">
<p>This error is a little tricky. Remember when we used <code class="highlighter-rouge">find_by</code> in the <code class="highlighter-rouge">SessionsController</code> <code class="highlighter-rouge">create</code> method to get the user by their username?</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">username: </span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:username</span><span class="p">])</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">find_by</code> will return the user only if a user with that username exists. Otherwise, it returns <code class="highlighter-rouge">nil</code>. So when you try to log in with an invalid username, <code class="highlighter-rouge">user</code> becomes nil.</p>

<p>That‚Äôs why you‚Äôre seeing the <code class="highlighter-rouge">NoMethodError</code> - you can‚Äôt call <code class="highlighter-rouge">authenticate</code> on <code class="highlighter-rouge">nil</code>.</p>

<p>To fix this error, we‚Äôll need to make a change in the <code class="highlighter-rouge">create</code> method.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/views/controllers/sessions_controller.rb</code>. Inside the <code class="highlighter-rouge">create</code> method change</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
</code></pre>
    </div>

    <p>With this change, <code class="highlighter-rouge">user.authenticate</code> will only be called if the user exists.</p>
  </li>
  <li>
    <p>Save your changes, revisit <a href="http://localhost:3000/session/new">http://localhost:3000/session/new</a>, and try logging in with an invalid username again.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">username: </span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:username</span><span class="p">])</span>

      <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
        <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Welcome back, </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">username</span><span class="si">}</span><span class="s2">!"</span>
        <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
        <span class="n">redirect_to</span> <span class="n">root_path</span>
      <span class="k">else</span>
        <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Sorry, your username or password is invalid."</span>
        <span class="n">render</span> <span class="ss">:new</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/successful_invalid_username.png" alt="Browser showing failure message when logging in with an invalid username" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>Yay! That‚Äôs a lot better, isn‚Äôt it?</p>

<ol>
  <li>
    <p>Now try logging in as ‚ÄúCatPower‚Äù, but use an invalid password. You should still get the failure message.</p>
  </li>
  <li>
    <p>Finally, try logging in as ‚ÄúCatPower‚Äù using ‚Äúpassword‚Äù as the password.</p>
  </li>
</ol>
</div>
</div>

<p><img src="/rails_tutorial/assets/images/success_valid_login.png" alt="Browser showing success message when logging in" class="screenshot" /></p>

<div class="steps">
<div class="list">
<p>YAYAY!!!</p>

<ol>
  <li>
    <p>Try clicking around the bookstore.</p>

    <p>The success message should go way as soon as you visit a new page.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<p>Now that you‚Äôre logged in, let‚Äôs make it so you can log out!</p>

<p>Let‚Äôs add a ‚ÄúLog out‚Äù link to your bookstore‚Äôs header.</p>

<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/views/layouts/application.html.erb</code>. Change the ‚Äúnavigation‚Äù <code class="highlighter-rouge">div</code> from</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navigation"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"My Super Rad Bookstore"</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
    </div>

    <p>to:</p>

    <div class="language-erb highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navigation"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"left"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"My Super Rad Bookstore"</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"right"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log Out"</span><span class="p">,</span> <span class="n">session_path</span><span class="p">,</span> <span class="ss">method: :delete</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
    </div>

    <p>Inside the ‚Äúnavigation‚Äù <code class="highlighter-rouge">div</code>, we‚Äôre adding two <code class="highlighter-rouge">div</code>s: a ‚Äúleft‚Äù <code class="highlighter-rouge">div</code> and a ‚Äúright‚Äù <code class="highlighter-rouge">div</code>. The ‚Äúleft‚Äù <code class="highlighter-rouge">div</code> is there to just keep things aligned. The ‚Äúright‚Äù <code class="highlighter-rouge">div</code> is really the one we‚Äôre interested in.</p>

    <p>In the ‚Äúright‚Äù <code class="highlighter-rouge">div</code>, we‚Äôre adding a ‚ÄúLog Out‚Äù link. When the link is clicked, it will send a DELETE request to the <code class="highlighter-rouge">session_path</code> (<code class="highlighter-rouge">/session</code>).</p>
  </li>
  <li>
    <p>Visit <a href="http://localhost:3000">http://localhost:3000</a> to see the new ‚ÄúLog Out‚Äù link.</p>

    <p>What do you think will happen if you try logging out? Give it a try üôÉ</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-erb" data-lang="erb"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></td><td class="code"><pre>  <span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;title&gt;</span>Bookstore<span class="nt">&lt;/title&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media: </span><span class="s1">'all'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span><span class="p">:</span> <span class="s1">'reload'</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navigation"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"left"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"My Super Rad Bookstore"</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"right"</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log Out"</span><span class="p">,</span> <span class="n">session_path</span><span class="p">,</span> <span class="ss">method: :delete</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"notice"</span><span class="nt">&gt;</span> <span class="cp">&lt;%=</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/p&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"alert"</span><span class="nt">&gt;</span> <span class="cp">&lt;%=</span> <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="cp">%&gt;</span> <span class="nt">&lt;/p&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<p><img src="/rails_tutorial/assets/images/yay_logout_link.png" alt="Browser showing homepage with a &quot;Log Out&quot; link" class="screenshot" /></p>

<p><img src="/rails_tutorial/assets/images/logout_destroy_unknown.png" alt="Browser showing Unknown action error: &quot;The action 'destroy' could not be found for SessionsController&quot;" class="screenshot" /></p>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Since the ‚ÄúLog Out‚Äù link sends a DELETE request, it gets routed to the <code class="highlighter-rouge">SessionsController</code> <code class="highlighter-rouge">destroy</code> method. Whelp, that explains the error you‚Äôre seeing.</p>

    <div class="language-text highlighter-rouge"><pre class="highlight"><code>The action 'destroy' could not be found for SessionsController
</code></pre>
    </div>
  </li>
  <li>
    <p>Let‚Äôs create the <code class="highlighter-rouge">destroy</code> method. Open the <code class="highlighter-rouge">SessionsController</code> (<code class="highlighter-rouge">app/controllers/sessions_controller.rb</code>), and add the following method:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">destroy</span>
  <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"See ya next time!"</span>
  <span class="n">redirect_to</span> <span class="n">root_path</span>
<span class="k">end</span>
</code></pre>
    </div>

    <p>The first line of this method removes the user_id we saved in the session by setting <code class="highlighter-rouge">session[:user_id]</code> to nil. The second line shows a friendly message confirming the user has been logged out. The final line redirects the user to the <code class="highlighter-rouge">root_path</code>.</p>
  </li>
  <li>
    <p>Save your changes and try logging out! After you‚Äôve logged out, stop your application‚Äôs web server.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">SessionsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">create</span>
      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">username: </span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:username</span><span class="p">])</span>

      <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:session</span><span class="p">][</span><span class="ss">:password</span><span class="p">])</span>
        <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Welcome back, </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">username</span><span class="si">}</span><span class="s2">!"</span>
        <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">id</span>
        <span class="n">redirect_to</span> <span class="n">root_path</span>
      <span class="k">else</span>
        <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Sorry, your username or password is invalid."</span>
        <span class="n">render</span> <span class="ss">:new</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">destroy</span>
      <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"See ya next time!"</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

      <div class="tutorial-button-group">
  
    
      <a href="/rails_tutorial/tutorial/chapter_12/" target="_self">
        <div class="back-button">
          Chapter 12
        </div>
      </a>
    
    
      <a href="/rails_tutorial/tutorial/chapter_14/" target="_self">
        <div class="next-button">
          Chapter 14
        </div>
      </a>
    
  
</div>

    </div>
  </div>
<footer>
  <div class="container">
    <a href="http://bmoreonrails.org/"><img src="/rails_tutorial/assets/icons/bmore.png"></a>
    <a href="https://github.com/bmoreonrails/rails_tutorial"><img class="icon" src="/rails_tutorial/assets/icons/github.png"></a>
    <a href="https://twitter.com/BmorRailsSchool"><img class="icon" src="/rails_tutorial/assets/icons/twitter.png"></a> 
  </div>
</footer>
</body>
</html>


<script>

$('img.screenshot').featherlight({
    targetAttr: 'src'
});

</script>
