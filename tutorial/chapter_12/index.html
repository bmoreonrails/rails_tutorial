<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
      <base target="_blank"/>
    
    <title>B'more on Rails Workshop for Women</title>
    <link href="/rails_tutorial/css/syntax/monokai.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/css/base.css" type="text/css" rel="stylesheet"/>
    <link href="/rails_tutorial/assets/vendor/css/featherlight.min.css" type="text/css" rel="stylesheet">
    <script src="/rails_tutorial/js/jquery.min.js"></script>
    <script src="/rails_tutorial/assets/vendor/js/featherlight.min.js"></script>
    <script src="/rails_tutorial/js/tutorial_nav.js"></script>
    <script src="/rails_tutorial/js/progress.js"></script>
  </head>

<body>
  <div class="container" data-chapter="12">
    <nav>
      
<div class="tutorial_nav">
  <div class="progress"><div class="progress_bar"></div></div>
  <ul id="menu-list">
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_01/" target="_self">
        1 Getting Started from Scratch
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_02/" target="_self">
        2 Creating the First Table in Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_03/" target="_self">
        3 Viewing Data in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_04/" target="_self">
        4 Showing Detailed Information in the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_05/" target="_self">
        5 Creating Books Through the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_06/" target="_self">
        6 Updating Books
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_07/" target="_self">
        7 Styling Your Bookstore
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_08/" target="_self">
        8 Deleting a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_09/" target="_self">
        9 Reviewing a Book
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_10/" target="_self">
        10 Showing Reviews
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_11/" target="_self">
        11 Adding Reviews from the Browser
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_12/" target="_self">
        12 Adding Users to Your Database
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_13/" target="_self">
        13 Logging In and Logging Out
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_14/" target="_self">
        14 Logged In vs Logged Out Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_15/" target="_self">
        15 Associating Reviews with Users
       </a>
     </li>
    
     <li>
      <a href="/rails_tutorial/tutorial/chapter_16/" target="_self">
        16 The End!
       </a>
     </li>
    
   </ul>

  <div class="menu">
    <div class="hamburger-icon" data-toggle="#menu-list"> &#9776</div>
    <div class="menu-title" data-toggle="#menu-list">Chapter 12 -- Adding Users to Your Database</div>
    <div class="menu-title"><a href="/rails_tutorial/" target="_self">Home</a></div>
  </div>
</div>

    </nav>
    <div class="content">
      <div class="sectionheader">
<p>Adding Users to Your Database</p>
</div>

<div class="aside">
<p>How does it feel to get all those reviews out of your system? I‚Äôm sure it feels good üòÜ</p>

<p>You worked really hard to write those reviews, but how will anyone know you wrote them?</p>

<p>What if people show up and start leaving reviews? How will you keep to track of who‚Äôs reviewing what?</p>

<p>We need users!</p>

<p>A user should be able to login to your bookstore. Once they‚Äôre logged in, any reviews they write can be attributed to them.</p>

<p>We‚Äôll start by adding users to your database.</p>
</div>

<div class="steps">
<div class="list">
<p>Let‚Äôs start by creating a migration for the <code class="highlighter-rouge">users</code> table.</p>

<ol>
  <li>
    <p>Open Terminal and go to the <code class="highlighter-rouge">bookstore</code> directory.</p>
  </li>
  <li>
    <p>Now, run <code class="highlighter-rouge">rails generate model user</code>.</p>

    <p>This command should be a little familiar. We used it earlier when added the <code class="highlighter-rouge">books</code> and <code class="highlighter-rouge">reviews</code> tables. It will generate a <code class="highlighter-rouge">CreateUsers</code> migration.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span><span class="nb">pwd</span>
  /Users/awesomesauce/Projects/bookstore

  <span class="nv">$ </span>rails generate model user
        invoke  active_record
        create    db/migrate/20170112224318_create_users.rb
        create    app/models/user.rb
        invoke    test_unit
        create      <span class="nb">test</span>/models/user_test.rb
        create      <span class="nb">test</span>/fixtures/users.yml</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">CreateUsers</code> migration in your text editor.</p>

    <p>Remember, the <code class="highlighter-rouge">CreateUsers</code> migration file has a timestamped filename.</p>

    <p><code class="highlighter-rouge">db/migrate/TIMESTAMP_create_users.rb</code></p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">change</span>
      <span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>

        <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<h3 id="theres-a-pattern-to-creating-tables-in-migrations">There‚Äôs a Pattern to Creating Tables in Migrations‚Ä¶</h3>

<p>Does the <code class="highlighter-rouge">CreateUsers</code> migration look familiar? It doesn‚Äôt do much yet, but it looks a lot like the <code class="highlighter-rouge">CreateBooks</code> and <code class="highlighter-rouge">CreateReviews</code> migrations.</p>

<p>Take a look at the <code class="highlighter-rouge">CreateBooks</code> migration to refresh your memory.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreateBooks</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:books</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:author</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:price_cents</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:quantity</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Just like the <code class="highlighter-rouge">CreateBooks</code> migration, the <code class="highlighter-rouge">CreateUsers</code> migration has a <code class="highlighter-rouge">change</code> method. Inside the <code class="highlighter-rouge">change</code> method, there‚Äôs a <code class="highlighter-rouge">create_table</code> block with the name of the table to create. In the <code class="highlighter-rouge">CreateBooks</code> migration the table name is <code class="highlighter-rouge">:books</code>, but in the the <code class="highlighter-rouge">CreateUsers</code> migration it‚Äôs <code class="highlighter-rouge">users</code>.</p>

<p>You define the columns you want to add to the table inside the <code class="highlighter-rouge">create_table</code> block. You added a bunch of columns in the <code class="highlighter-rouge">CreateBooks</code> migration, but you haven‚Äôt added any to the <code class="highlighter-rouge">CreateUsers</code> migration‚Ä¶yet üòâ</p>
</div>

<div class="steps">
<div class="list">
<p>To support users logging in, we need to add a couple of columns to the <code class="highlighter-rouge">users</code> table.</p>

<p>First, we‚Äôll need to add a <code class="highlighter-rouge">username</code> for the‚Ä¶user‚Äôs name.</p>

<p>Then, we‚Äôll need to add a <code class="highlighter-rouge">password_digest</code> column. This will be used to securely store user passwords (more on that later).</p>

<p>Both columns will be <code class="highlighter-rouge">string</code> columns.</p>

<ol>
  <li>
    <p>Using your other migrations as examples, update the <code class="highlighter-rouge">create_table</code> block in the <code class="highlighter-rouge">CreateUsers</code> migration so <code class="highlighter-rouge">username</code> and <code class="highlighter-rouge">password_digest</code> are added as <code class="highlighter-rouge">string</code> columns to the <code class="highlighter-rouge">users</code> table.</p>
  </li>
  <li>
    <p>When you‚Äôre done, save your changes, and run the migration by running <code class="highlighter-rouge">rake db:migrate</code>.</p>

    <p>If you make any mistakes, you can always undo the migration by running <code class="highlighter-rouge">rake db:rollback</code>. Then, you can make changes to the <code class="highlighter-rouge">CreateUsers</code> migration and re-run it with <code class="highlighter-rouge">rake db:migrate</code>.</p>
  </li>
</ol>
</div>
</div>

<div class="steps">
<div class="list">
<p>What does your solution look like?! Did you add the columns to the <code class="highlighter-rouge">users</code> table??</p>

<ol>
  <li>
    <p>Your <code class="highlighter-rouge">create_table</code> block should look something like this:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:username</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:password_digest</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
<span class="k">end</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>If your <code class="highlighter-rouge">create_table</code> block doesn‚Äôt look like this, update your soultion to match this solution and run the migration.</p>

    <p>If you ran the migration without the <code class="highlighter-rouge">username</code> or <code class="highlighter-rouge">password_digest</code> columns, you‚Äôll need to rollback the migration and run it again.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">change</span>
      <span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:username</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:password_digest</span>
        <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<h3 id="whats-a-password-digest">What‚Äôs a Password Digest?</h3>

<p>You‚Äôre bookstore application now has a <code class="highlighter-rouge">users</code> table with a couple of columns. The <code class="highlighter-rouge">username</code> column probably seems reasonable, but I‚Äôm sure the <code class="highlighter-rouge">password_digest</code> column looks questionable. What‚Äôs a <em>password digest</em> anyways?</p>

<p>Rails provides a feature to make password management convienient. By adding the <code class="highlighter-rouge">passowrd_digest</code> column, you‚Äôve already taken the first step towards using this feature.</p>

<p>The next step is going to require a code change.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open <code class="highlighter-rouge">app/models/user.rb</code> in your text editor.</p>
  </li>
  <li>
    <p>Inside the <code class="highlighter-rouge">User</code> class, add the following line:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">has_secure_password</span>
</code></pre>
    </div>

    <p>This will call Rails‚Äô <code class="highlighter-rouge">has_secure_password</code> method to make the password management feature available on all users.</p>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>  <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
    <span class="n">has_secure_password</span>
  <span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Let‚Äôs see what we can do with the <code class="highlighter-rouge">User</code> class.</p>

<ol>
  <li>
    <p>Go to Terminal and start the <code class="highlighter-rouge">rails console</code>.</p>
  </li>
  <li>
    <p>Now, let‚Äôs try building your bookstore‚Äôs first user. Run the following code:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">my_first_user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">username: </span><span class="s2">"CatPower"</span><span class="p">)</span>
</code></pre>
    </div>

    <p>Woah! That‚Äôs a gnarly error!</p>
  </li>
  <li>
    <p>If you look closely at the error, it‚Äôs trying to tell you what‚Äôs wrong. It even has a suggestion on how you can fix it.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">You</span> <span class="n">don</span><span class="err">'</span><span class="n">t</span> <span class="n">have</span> <span class="n">bcrypt</span> <span class="n">installed</span> <span class="k">in</span> <span class="n">your</span> <span class="n">application</span><span class="o">.</span> <span class="no">Please</span> <span class="n">add</span> <span class="n">it</span> <span class="n">to</span> <span class="n">your</span> <span class="no">Gemfile</span> <span class="n">and</span> <span class="n">run</span> <span class="n">bundle</span> <span class="n">install</span>
</code></pre>
    </div>

    <p>Let‚Äôs break down this error, but first - exit the rails console.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="err">$</span> <span class="n">rails</span> <span class="n">console</span>
  <span class="no">Loading</span> <span class="n">development</span> <span class="n">environment</span> <span class="p">(</span><span class="no">Rails</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
  <span class="o">&gt;&gt;</span> <span class="n">my_first_user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">username: </span><span class="s2">"CatPower"</span><span class="p">)</span>
  <span class="no">You</span> <span class="n">don</span><span class="err">'</span><span class="n">t</span> <span class="n">have</span> <span class="n">bcrypt</span> <span class="n">installed</span> <span class="k">in</span> <span class="n">your</span> <span class="n">application</span><span class="o">.</span> <span class="no">Please</span> <span class="n">add</span> <span class="n">it</span> <span class="n">to</span> <span class="n">your</span> <span class="no">Gemfile</span> <span class="n">and</span> <span class="n">run</span> <span class="n">bundle</span> <span class="n">install</span>
  <span class="no">LoadError</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">load</span> <span class="n">such</span> <span class="n">file</span> <span class="o">--</span> <span class="n">bcrypt</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>

  <span class="nf">&gt;</span><span class="o">&gt;</span> <span class="nb">exit</span></code></pre></figure>

</div>

<div class="aside">
<h3 id="bcrypt-rubygems-and-gemfiles">bcrypt, RubyGems, and Gemfiles</h3>
<p>Let‚Äôs take a look at the first part of the error.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">You</span> <span class="n">don</span><span class="err">'</span><span class="n">t</span> <span class="n">have</span> <span class="n">bcrypt</span> <span class="n">installed</span> <span class="k">in</span> <span class="n">your</span> <span class="n">application</span><span class="o">.</span>
</code></pre>
</div>

<p>Your bookstore application doesn‚Äôt have bcrypt installed, and it never did. Why‚Äôs that a problem now?</p>

<p><code class="highlighter-rouge">has_secure_password</code> is being run on every <code class="highlighter-rouge">User</code>, including <code class="highlighter-rouge">my_first_user</code>. Under the hood, <code class="highlighter-rouge">has_secure_password</code> uses bcrypt to encrypt and save passwords.</p>

<p>Since your bookstore application doesn‚Äôt have bcrypt, <code class="highlighter-rouge">has_secure_password</code> can‚Äôt run and it throws this error.</p>

<p>Now that we have some idea of what the problem is, how can we fix it? Let‚Äôs take a look at the second part of the error.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="no">Please</span> <span class="n">add</span> <span class="n">it</span> <span class="n">to</span> <span class="n">your</span> <span class="no">Gemfile</span> <span class="n">and</span> <span class="n">run</span> <span class="n">bundle</span> <span class="n">install</span>
</code></pre>
</div>

<p>Hmm‚Ä¶I guess we have to add bcrypt to your Gemfile.</p>

<p><em>What‚Äôs a Gemfile?</em></p>

<p>Ah, a Gemfile! It‚Äôs a really important part of the Ruby ecosystem.</p>

<p>A lot of Ruby projects have Gemfiles to manage the RubyGems they use.</p>

<p><em>Huh‚Ä¶what‚Äôs a RubyGem?</em></p>

<p>A RubyGem is a bundle of Ruby code that can be used in any Ruby project. Some RubyGems are <a href="https://rubygems.org/gems/rspec-pride">small</a>, and others are <a href="https://rubygems.org/gems/rails">pretty big</a>.</p>

<p>RubyGems are usually referred to as Gems because who has time for all those syllables.</p>

<p><a href="https://rubygems.org/gems/bcrypt">bcrypt</a> is a RubyGem.</p>

<p>Your bookstore application <strong>is</strong> a Ruby project, it just happens to be a Rails application too üòâ</p>

<p>As a Ruby project that uses RubyGems, it has a Gemfile. Let‚Äôs take a look at it.</p>
</div>

<div class="steps">
<div class="list">
<p>Your application‚Äôs Gemfile is a file named‚Ä¶<code class="highlighter-rouge">Gemfile</code>. It‚Äôs not nested inside any directories, and it‚Äôs one of the first files in the <code class="highlighter-rouge">bookstore</code> directory.</p>

<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">Gemfile</code> in your text editor.</p>

    <p>Woah! Your application‚Äôs Gemfile already has some stuff in it!</p>

    <p>Turns out your application has been using a Gemfile this whole time.</p>

    <p><img src="/rails_tutorial/assets/images/whoknew.gif" alt="Who knew?" /></p>

    <p>Your application‚Äôs <code class="highlighter-rouge">Gemfile</code> is the default Gemfile that ships with all new Rails applications. You can choose different RubyGems, but this default list helps you get started quickly.</p>

    <p>If you read through the <code class="highlighter-rouge">Gemfile</code>, you might recongize some RubyGems we‚Äôve been using. You might even come across a RubyGem that brought us here in the first place‚Ä¶</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></td><td class="code"><pre>  <span class="n">source</span> <span class="s1">'http://rubygems.org'</span>


  <span class="c1"># Bundle edge Rails instead: gem 'rails', github: 'rails/rails'</span>
  <span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span> <span class="s1">'~&gt; 5.0.0'</span><span class="p">,</span> <span class="s1">'&gt;= 5.0.0.1'</span>
  <span class="c1"># Use sqlite3 as the database for Active Record</span>
  <span class="n">gem</span> <span class="s1">'sqlite3'</span>
  <span class="c1"># Use Puma as the app server</span>
  <span class="n">gem</span> <span class="s1">'puma'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0'</span>
  <span class="c1"># Use SCSS for stylesheets</span>
  <span class="n">gem</span> <span class="s1">'sass-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 5.0'</span>
  <span class="c1"># Use Uglifier as compressor for JavaScript assets</span>
  <span class="n">gem</span> <span class="s1">'uglifier'</span><span class="p">,</span> <span class="s1">'&gt;= 1.3.0'</span>
  <span class="c1"># Use CoffeeScript for .coffee assets and views</span>
  <span class="n">gem</span> <span class="s1">'coffee-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.2'</span>
  <span class="c1"># See https://github.com/rails/execjs#readme for more supported runtimes</span>
  <span class="c1"># gem 'therubyracer', platforms: :ruby</span>

  <span class="c1"># Use jquery as the JavaScript library</span>
  <span class="n">gem</span> <span class="s1">'jquery-rails'</span>
  <span class="c1"># Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks</span>
  <span class="n">gem</span> <span class="s1">'turbolinks'</span><span class="p">,</span> <span class="s1">'~&gt; 5'</span>
  <span class="c1"># Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder</span>
  <span class="n">gem</span> <span class="s1">'jbuilder'</span><span class="p">,</span> <span class="s1">'~&gt; 2.5'</span>
  <span class="c1"># Use Redis adapter to run Action Cable in production</span>
  <span class="c1"># gem 'redis', '~&gt; 3.0'</span>
  <span class="c1"># Use ActiveModel has_secure_password</span>
  <span class="c1"># gem 'bcrypt', '~&gt; 3.1.7'</span>

  <span class="c1"># Use Capistrano for deployment</span>
  <span class="c1"># gem 'capistrano-rails', group: :development</span>

  <span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
    <span class="c1"># Call 'byebug' anywhere in the code to stop execution and get a debugger console</span>
    <span class="n">gem</span> <span class="s1">'byebug'</span><span class="p">,</span> <span class="ss">platform: :mri</span>
  <span class="k">end</span>

  <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
    <span class="c1"># Access an IRB console on exception pages or by using &lt;%= console %&gt; anywhere in the code.</span>
    <span class="n">gem</span> <span class="s1">'web-console'</span>
    <span class="n">gem</span> <span class="s1">'listen'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0.5'</span>
    <span class="c1"># Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring</span>
    <span class="n">gem</span> <span class="s1">'spring'</span>
    <span class="n">gem</span> <span class="s1">'spring-watcher-listen'</span><span class="p">,</span> <span class="s1">'~&gt; 2.0.0'</span>
  <span class="k">end</span>

  <span class="c1"># Windows does not include zoneinfo files, so bundle the tzinfo-data gem</span>
  <span class="n">gem</span> <span class="s1">'tzinfo-data'</span><span class="p">,</span> <span class="ss">platforms: </span><span class="p">[</span><span class="ss">:mingw</span><span class="p">,</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:x64_mingw</span><span class="p">,</span> <span class="ss">:jruby</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Did you find find bcrypt in your Gemfile?! It‚Äôs tucked in there‚Ä¶</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># Use ActiveModel has_secure_password</span>
<span class="c1"># gem 'bcrypt', '~&gt; 3.1.7'</span>
</code></pre>
    </div>

    <p><em>Wait a minute‚Ä¶if bcrypt is in my Gemfile why isn‚Äôt it in my application?</em></p>

    <p>bcrypt is in your Gemfile, but it‚Äôs only included as comment. In Ruby, any line that starts with <code class="highlighter-rouge">#</code> is a comment. Comments are never run; they‚Äôre just messages to help you understand what‚Äôs going on.</p>
  </li>
  <li>
    <p>To include bcrypt, you just need to uncomment that line. Change</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="c1"># gem 'bcrypt', '~&gt; 3.1.7'</span>
</code></pre>
    </div>

    <p>to</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'bcrypt'</span><span class="p">,</span> <span class="s1">'~&gt; 3.1.7'</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Save your changes.</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></td><td class="code"><pre>  <span class="n">source</span> <span class="s1">'http://rubygems.org'</span>


  <span class="c1"># Bundle edge Rails instead: gem 'rails', github: 'rails/rails'</span>
  <span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span> <span class="s1">'~&gt; 5.0.0'</span><span class="p">,</span> <span class="s1">'&gt;= 5.0.0.1'</span>
  <span class="c1"># Use sqlite3 as the database for Active Record</span>
  <span class="n">gem</span> <span class="s1">'sqlite3'</span>
  <span class="c1"># Use Puma as the app server</span>
  <span class="n">gem</span> <span class="s1">'puma'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0'</span>
  <span class="c1"># Use SCSS for stylesheets</span>
  <span class="n">gem</span> <span class="s1">'sass-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 5.0'</span>
  <span class="c1"># Use Uglifier as compressor for JavaScript assets</span>
  <span class="n">gem</span> <span class="s1">'uglifier'</span><span class="p">,</span> <span class="s1">'&gt;= 1.3.0'</span>
  <span class="c1"># Use CoffeeScript for .coffee assets and views</span>
  <span class="n">gem</span> <span class="s1">'coffee-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 4.2'</span>
  <span class="c1"># See https://github.com/rails/execjs#readme for more supported runtimes</span>
  <span class="c1"># gem 'therubyracer', platforms: :ruby</span>

  <span class="c1"># Use jquery as the JavaScript library</span>
  <span class="n">gem</span> <span class="s1">'jquery-rails'</span>
  <span class="c1"># Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks</span>
  <span class="n">gem</span> <span class="s1">'turbolinks'</span><span class="p">,</span> <span class="s1">'~&gt; 5'</span>
  <span class="c1"># Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder</span>
  <span class="n">gem</span> <span class="s1">'jbuilder'</span><span class="p">,</span> <span class="s1">'~&gt; 2.5'</span>
  <span class="c1"># Use Redis adapter to run Action Cable in production</span>
  <span class="c1"># gem 'redis', '~&gt; 3.0'</span>
  <span class="c1"># Use ActiveModel has_secure_password</span>
  <span class="n">gem</span> <span class="s1">'bcrypt'</span><span class="p">,</span> <span class="s1">'~&gt; 3.1.7'</span>

  <span class="c1"># Use Capistrano for deployment</span>
  <span class="c1"># gem 'capistrano-rails', group: :development</span>

  <span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
    <span class="c1"># Call 'byebug' anywhere in the code to stop execution and get a debugger console</span>
    <span class="n">gem</span> <span class="s1">'byebug'</span><span class="p">,</span> <span class="ss">platform: :mri</span>
  <span class="k">end</span>

  <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
    <span class="c1"># Access an IRB console on exception pages or by using &lt;%= console %&gt; anywhere in the code.</span>
    <span class="n">gem</span> <span class="s1">'web-console'</span>
    <span class="n">gem</span> <span class="s1">'listen'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0.5'</span>
    <span class="c1"># Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring</span>
    <span class="n">gem</span> <span class="s1">'spring'</span>
    <span class="n">gem</span> <span class="s1">'spring-watcher-listen'</span><span class="p">,</span> <span class="s1">'~&gt; 2.0.0'</span>
  <span class="k">end</span>

  <span class="c1"># Windows does not include zoneinfo files, so bundle the tzinfo-data gem</span>
  <span class="n">gem</span> <span class="s1">'tzinfo-data'</span><span class="p">,</span> <span class="ss">platforms: </span><span class="p">[</span><span class="ss">:mingw</span><span class="p">,</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:x64_mingw</span><span class="p">,</span> <span class="ss">:jruby</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

</div>

<div class="aside">
<h3 id="how-do-we-install-rubygems-from-the-gemfile">How Do We Install RubyGems From the Gemfile?</h3>

<p>Now that bcrypt is part of your <code class="highlighter-rouge">Gemfile</code>, you‚Äôre ready to install it.</p>

<p>The RubyGems in your <code class="highlighter-rouge">Gemfile</code> are installed by <code class="highlighter-rouge">bundle install</code>.</p>

<p>You might remember <code class="highlighter-rouge">bundle install</code> from a looooong time ago. <code class="highlighter-rouge">rails new</code> runs <code class="highlighter-rouge">bundle install</code> as its last step in creating your application.</p>
</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Open Terminal and run <code class="highlighter-rouge">bundle install</code>.</p>

    <p><code class="highlighter-rouge">bundle install</code> goes through each RubyGem in your <code class="highlighter-rouge">Gemfile</code> and decides if it needs to install it or not. If your application already has the RubyGem, it will output ‚ÄúUsing‚Ä¶‚Äù and move on to the next RubyGem.</p>

    <p>We‚Äôre only adding one RubyGem to your application - bcrypt. When <code class="highlighter-rouge">bundle install</code> gets to bcrypt, it will tell you that it‚Äôs being installed:</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>Installing bcrypt 3.1.11 with native extensions
</code></pre>
    </div>
  </li>
  <li>
    <p>When <code class="highlighter-rouge">bundle install</code> finishes, you‚Äôll get a message telling you how many RubyGems your application is using.</p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code>Bundle <span class="nb">complete</span>! 16 Gemfile dependencies, 63 gems now installed.
</code></pre>
    </div>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">  <span class="nv">$ </span>bundle install
  Fetching gem metadata from http://rubygems.org/.........
  Fetching version metadata from http://rubygems.org/..
  Fetching dependency metadata from http://rubygems.org/.
  Using rake 11.3.0
  Using concurrent-ruby 1.0.2
  Using i18n 0.7.0
  Using minitest 5.9.1
  Using thread_safe 0.3.5
  Using builder 3.2.2
  Using erubis 2.7.0
  Using mini_portile2 2.1.0
  Using rack 2.0.1
  Using nio4r 1.2.1
  Using websocket-extensions 0.1.2
  Using mime-types-data 3.2016.0521
  Using arel 7.1.4
  Installing bcrypt 3.1.11 with native extensions
  Using byebug 9.0.6
  Using coffee-script-source 1.10.0
  Using execjs 2.7.0
  Using method_source 0.8.2
  Using thor 0.19.1
  Using debug_inspector 0.0.2
  Using ffi 1.9.14
  Using multi_json 1.12.1
  Using rb-fsevent 0.9.8
  Using puma 3.6.0
  Using bundler 1.13.6
  Using sass 3.4.22
  Using tilt 2.0.5
  Using sqlite3 1.3.12
  Using turbolinks-source 5.0.0
  Using tzinfo 1.2.2
  Using nokogiri 1.6.8.1
  Using rack-test 0.6.3
  Using sprockets 3.7.0
  Using websocket-driver 0.6.4
  Using mime-types 3.1
  Using coffee-script 2.4.1
  Using uglifier 3.0.3
  Using rb-inotify 0.9.7
  Using turbolinks 5.0.1
  Using activesupport 5.0.0.1
  Using loofah 2.0.3
  Using mail 2.6.4
  Using listen 3.0.8
  Using rails-dom-testing 2.0.1
  Using globalid 0.3.7
  Using activemodel 5.0.0.1
  Using jbuilder 2.6.0
  Using spring 2.0.0
  Using rails-html-sanitizer 1.0.3
  Using activejob 5.0.0.1
  Using activerecord 5.0.0.1
  Using spring-watcher-listen 2.0.1
  Using actionview 5.0.0.1
  Using actionpack 5.0.0.1
  Using actioncable 5.0.0.1
  Using actionmailer 5.0.0.1
  Using railties 5.0.0.1
  Using sprockets-rails 3.2.0
  Using coffee-rails 4.2.1
  Using jquery-rails 4.2.1
  Using web-console 3.4.0
  Using rails 5.0.0.1
  Using sass-rails 5.0.6
  Bundle <span class="nb">complete</span>! 16 Gemfile dependencies, 63 gems now installed.
  Use <span class="sb">`</span>bundle show <span class="o">[</span>gemname]<span class="sb">`</span> to see where a bundled gem is installed.</code></pre></figure>

</div>

<div class="steps">
<div class="list">
<p>Now that you‚Äôre application is using bcrypt, maybe we can start doing stuff with <code class="highlighter-rouge">User</code>s. üòÑ</p>

<ol>
  <li>
    <p>Open the <code class="highlighter-rouge">rails console</code> and run the following:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">my_first_user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">username: </span><span class="s2">"CatPower"</span><span class="p">)</span>
</code></pre>
    </div>

    <p><em>Yay! No errors</em> üéâ</p>

    <p>This assigns a new <code class="highlighter-rouge">User</code> with <code class="highlighter-rouge">username</code> ‚ÄúCatPower‚Äù to <code class="highlighter-rouge">my_first_user</code>.</p>

    <p><code class="highlighter-rouge">my_first_user</code> has a <code class="highlighter-rouge">username</code>, but she doesn‚Äôt have a password.</p>

    <p>Fortunately, <code class="highlighter-rouge">has_secure_password</code> added a method to <code class="highlighter-rouge">User</code> so you can set passwords.</p>
  </li>
  <li>
    <p>Try setting a password for <code class="highlighter-rouge">my_first_user</code> by running:</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">my_first_user</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"password"</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Now, try saving <code class="highlighter-rouge">my_first_user</code>.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">my_first_user</span><span class="p">.</span><span class="nf">save</span>
</code></pre>
    </div>

    <p>Wait‚Ä¶that worked?</p>

    <p><img src="/rails_tutorial/assets/images/noway.gif" alt="No way" /></p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="o">&gt;&gt;</span> <span class="n">my_first_user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">username: </span><span class="s1">'CatPower'</span><span class="p">)</span>
  <span class="o">=&gt;</span> <span class="c1">#&lt;User id: nil, username: "CatPower", password_digest: nil, created_at: nil, updated_at: nil&gt;</span>

  <span class="o">&gt;&gt;</span> <span class="n">my_first_user</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s1">'password'</span>
  <span class="o">=&gt;</span> <span class="s2">"password"</span>

  <span class="o">&gt;&gt;</span> <span class="n">my_first_user</span><span class="p">.</span><span class="nf">save</span>
     <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">begin</span> <span class="n">transaction</span>
    <span class="no">SQL</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span><span class="p">)</span>  <span class="no">INSERT</span> <span class="no">INTO</span> <span class="s2">"users"</span> <span class="p">(</span><span class="s2">"username"</span><span class="p">,</span> <span class="s2">"password_digest"</span><span class="p">,</span> <span class="s2">"created_at"</span><span class="p">,</span> <span class="s2">"updated_at"</span><span class="p">)</span> <span class="no">VALUES</span> <span class="p">(</span><span class="sc">?,</span> <span class="sc">?,</span> <span class="sc">?,</span> <span class="sc">?)</span>  <span class="p">[[</span><span class="s2">"username"</span><span class="p">,</span> <span class="s2">"CatPower"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"password_digest"</span><span class="p">,</span> <span class="s2">"$2a$10$T9KFCyIrtgFhBtEixMYm9e757ZXa7UlBVOyaAzCtbwt2rNP5snSle"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"created_at"</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">13</span> <span class="mo">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">39</span> <span class="no">UTC</span><span class="p">],</span> <span class="p">[</span><span class="s2">"updated_at"</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">13</span> <span class="mo">02</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">39</span> <span class="no">UTC</span><span class="p">]]</span>
     <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="n">commit</span> <span class="n">transaction</span>
  <span class="o">=&gt;</span> <span class="kp">true</span></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Take a look at how the password was saved into the <code class="highlighter-rouge">users</code> table. Run <code class="highlighter-rouge">my_first_user.password_digest</code>.</p>

    <p>That‚Äôs not the generic password you were expecting, was it?</p>

    <p><code class="highlighter-rouge">has_secure_password</code> transformed the plain text password you set on <code class="highlighter-rouge">my_first_user</code> into an encrypted password. Then, the encrypted password was stored in the <code class="highlighter-rouge">password_digest</code> column.</p>
  </li>
  <li>
    <p>Now that you have a user with a password, you can authenticate her.</p>

    <p>What do you think will happen when you run the following code?</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">my_first_user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"password"</span><span class="p">)</span>
</code></pre>
    </div>

    <p>What about if you do something like this instead?</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">my_first_user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"I'm just guessing"</span><span class="p">)</span>
</code></pre>
    </div>

    <p>Give them a try!</p>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="o">&gt;&gt;</span> <span class="n">my_first_user</span><span class="p">.</span><span class="nf">password_digest</span>
  <span class="o">=&gt;</span> <span class="s2">"$2a$10$T9KFCyIrtgFhBtEixMYm9e757ZXa7UlBVOyaAzCtbwt2rNP5snSle"</span></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>When you run <code class="highlighter-rouge">my_first_user.authenticate</code> with <code class="highlighter-rouge">my_first_user</code>‚Äôs password, <code class="highlighter-rouge">authenticate</code> returned the user.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;</span> <span class="n">my_first_user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"password"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;User id: 1, username: "CatPower", password_digest: "$2a$10$T9KFCyIrtgFhBtEixMYm9e757ZXa7UlBVOyaAzCtbwt...", created_at: "2017-01-13 02:57:39", updated_at: "2017-01-13 02:57:39"&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>When you run <code class="highlighter-rouge">my_first_user.authenticate</code> with an invalid password, <code class="highlighter-rouge">authenticate</code> returned false.</p>

    <div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;</span> <span class="n">my_first_user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"bad password"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
</code></pre>
    </div>
  </li>
</ol>
</div>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="o">&gt;&gt;</span> <span class="n">my_first_user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"password"</span><span class="p">)</span>
  <span class="o">=&gt;</span> <span class="c1">#&lt;User id: 1, username: "CatPower", password_digest: "$2a$10$T9KFCyIrtgFhBtEixMYm9e757ZXa7UlBVOyaAzCtbwt...", created_at: "2017-01-13 02:57:39", updated_at: "2017-01-13 02:57:39"&gt;</span>

  <span class="o">&gt;&gt;</span> <span class="n">my_first_user</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"bad password"</span><span class="p">)</span>
  <span class="o">=&gt;</span> <span class="kp">false</span></code></pre></figure>

</div>

<div class="steps">
<div class="list">
<ol>
  <li>
    <p>Yay! Now you can create users, securely store their passwords, and authenticate them.</p>

    <p>Exit the <code class="highlighter-rouge">rails console</code> and do your happy dance.</p>

    <p><img src="/rails_tutorial/assets/images/happy_dance.gif" alt="Lisa's happy dance" /></p>
  </li>
</ol>
</div>
</div>

      <div class="tutorial-button-group">
  
    
      <a href="/rails_tutorial/tutorial/chapter_11/" target="_self">
        <div class="back-button">
          Chapter 11
        </div>
      </a>
    
    
      <a href="/rails_tutorial/tutorial/chapter_13/" target="_self">
        <div class="next-button">
          Chapter 13
        </div>
      </a>
    
  
</div>

    </div>
  </div>
<footer>
  <div class="container">
    <a href="http://bmoreonrails.org/"><img src="/rails_tutorial/assets/icons/bmore.png"></a>
    <a href="https://github.com/bmoreonrails/rails_tutorial"><img class="icon" src="/rails_tutorial/assets/icons/github.png"></a>
    <a href="https://twitter.com/BmorRailsSchool"><img class="icon" src="/rails_tutorial/assets/icons/twitter.png"></a> 
  </div>
</footer>
</body>
</html>


<script>

$('img.screenshot').featherlight({
    targetAttr: 'src'
});

</script>
